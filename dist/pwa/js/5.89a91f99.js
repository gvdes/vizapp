(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{3039:function(t,e,s){"use strict";s("f77e")},"4f6a":function(t,e,s){"use strict";s("fb00")},c36e:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-page",[i("q-header",{staticClass:"bg-darkl1",attrs:{unelevated:""}},[i("div",{staticClass:"row items-center justify-between"},[i("q-btn",{attrs:{flat:"",icon:"close"},on:{click:function(e){return t.$router.push("/preventa/checkout")}}}),i("div",{staticClass:"row items-center col bg-dark divlcient _client"},[i("div",{staticClass:"q-pa-sm col text-center"},[i("div",{staticClass:"text--2"},[t._v("Cliente:")]),t.order?i("div",{staticClass:"text-uppercase"},[t._v("\n                        "+t._s(t.order.name)+"\n                    ")]):t._e()]),i("div",{staticClass:"q-pa-sm col text-center"},[i("div",{staticClass:"text--2"},[t._v("Checkout:")]),i("div",{staticClass:"text-bold"},[t._v(t._s(t.ordercatch.id))])])]),i("q-btn",{attrs:{flat:"",icon:"menu"}})],1),i("div",{staticClass:"row items-center justify-between q-mt-sm"},[i("div",{staticClass:"row text-center"},[i("div",{staticClass:"q-px-md"},[i("div",{staticClass:"text--2"},[t._v("Modelos")]),i("span",{staticClass:"text-green-13 text-bold"},[t._v(t._s(t.inbasket.length))])]),i("div",{staticClass:"q-px-md"},[i("div",{staticClass:"text--2"},[t._v("Unidades")]),i("span",{staticClass:"text-green-13 text-bold"},[t._v(t._s(t.pzsBasket))])]),i("div",{staticClass:"q-px-md"},[i("div",{staticClass:"text--2"},[t._v("Cajas")]),i("span",{staticClass:"text-green-13 text-bold"},[t._v(t._s(t.bxsBasket))])])]),i("div",{staticClass:"col text-right q-px-sm"},[i("div",{staticClass:"text--2"},[t._v("Total")]),i("div",{staticClass:"text-green-13 text-h6 text-bold"},[t._v("$ "+t._s(t.totalBasket))])])])]),i("div",{staticClass:"q-mb-xl"},[i("div",[i("div",{staticClass:"q-pa-md bg-blue-grey-8 row items-center justify-between"},[i("span",[t._v("Canasta: "+t._s(t.outbasket.length))]),i("span",[t._v("$ "+t._s(t.totalOutBasket))])]),i("transition-group",{attrs:{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"}},t._l(t.outbasket,(function(e){return i("div",{key:e.id,staticClass:"q-py-md q-px-sm wrapper_prod",on:{click:function(s){return t.confirm(e)}}},[i("div",{staticClass:"row items-center"},[i("div",{staticClass:"q-pr-sm"},[i("q-img",{attrs:{src:s("d3b1"),width:"50px"}})],1),i("div",{staticClass:"col q-pr-sm"},[i("div",[i("span",[t._v(t._s(e.code))]),t._v(" --\n                                "),i("span",[t._v(t._s(e.name))])]),i("div",{staticClass:"text--2 text-grey-5"},[t._v(t._s(e.description))]),i("div",{staticClass:"text--2 text-amber-13"},[t._v(t._s(e.ordered.comments))]),i("div",{staticClass:"col text--2"},[t._v(t._s(e.metsupply.name)+" "+t._s(e.ordered.amount)+t._s(1!=e.metsupply.id?" ("+e.units+" pzs)":"")+", PU: $"+t._s(e.usedprice.price))])]),i("div",{staticClass:"text-right text-green-13"},[t._v("$ "+t._s(e.total))])])])})),0)],1),i("div",[i("div",{staticClass:"q-pa-md bg-primary row items-center justify-between"},[i("span",[t._v("Canasta: "+t._s(t.inbasket.length))]),i("span",[t._v("$ "+t._s(t.totalBasket))])]),i("transition-group",{attrs:{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"}},t._l(t.inbasket,(function(e){return i("div",{key:e.id,staticClass:"q-py-md q-px-sm wrapper_prod",on:{click:function(s){return t.edit(e)}}},[i("div",{staticClass:"row items-center"},[i("div",{staticClass:"q-pr-sm"},[i("q-img",{attrs:{src:s("d3b1"),width:"50px"}})],1),i("div",{staticClass:"col q-pr-sm"},[i("div",[i("span",[t._v(t._s(e.code))]),t._v(" --\n                                "),i("span",[t._v(t._s(e.name))])]),i("div",{staticClass:"text--2 text-grey-5"},[t._v(t._s(e.description))]),i("div",{staticClass:"text--2 text-amber-13"},[t._v(t._s(e.ordered.comments))]),i("div",{staticClass:"col text--2"},[t._v(t._s(e.metsupply.name)+" "+t._s(e.ordered.amount)+t._s(1!=e.metsupply.id?" ("+e.units+" pzs)":"")+", PU: $"+t._s(e.usedprice.price))])]),i("div",{staticClass:"text-right text-green-13"},[t._v("$ "+t._s(e.total))])])])})),0)],1)]),i("q-dialog",{attrs:{position:"bottom"},on:{hide:t.cleanCounter},model:{value:t.wndCounter.state,callback:function(e){t.$set(t.wndCounter,"state",e)},expression:"wndCounter.state"}},[t.wndCounter.product?[i("q-card",{staticClass:"bg-darkl1 text-white exo"},[i("q-card-section",[t._v("Confirmar")]),i("ProductAOE",{attrs:{product:t.wndCounter.product,client:t.order.client,showprices:""},on:{confirm:t.productConfirm}})],1)]:t._e()],2),i("q-dialog",{staticClass:"exo",attrs:{position:"bottom"},on:{hide:t.cleanEditor},model:{value:t.wndEditor.state,callback:function(e){t.$set(t.wndEditor,"state",e)},expression:"wndEditor.state"}},[t.wndEditor.product?[i("q-card",{staticClass:"bg-darkl1 text-white exo"},[i("q-card-section",[t._v("Editar")]),i("ProductAOE",{attrs:{product:t.wndEditor.product,client:t.order.client,showprices:""},on:{confirm:t.productEdit}})],1)]:t._e()],2),i("q-dialog",{attrs:{position:"bottom"},on:{hide:t.cleanAdder},model:{value:t.wndAdder.state,callback:function(e){t.$set(t.wndAdder,"state",e)},expression:"wndAdder.state"}},[i("q-card",{staticClass:"text-white bg-darkl1 exo"},[i("q-card-section",[i("div",{staticClass:"q-pb-md"},[t._v("Anexar Producto")]),i("ProductAutocomplete",{attrs:{with_image:"",with_prices:"",with_stock:""},on:{input:t.setProduct}})],1),t.wndAdder.product?[i("ProductAOE",{attrs:{product:t.wndAdder.product,client:t.order.client,showprices:""},on:{confirm:t.productAdd}})]:t._e()],2)],1),i("q-dialog",{attrs:{persistent:t.wndSending.persistent,position:"bottom"},model:{value:t.wndSending.state,callback:function(e){t.$set(t.wndSending,"state",e)},expression:"wndSending.state"}},[i("q-card",{staticClass:"bg-darkl1 text-white exo"},[i("q-card-section",{staticClass:"text-h6 bfv"},[t._v("Confirmar Pedido...")]),i("q-btn-group",{attrs:{spread:""}},[i("q-btn",{staticClass:"q-py-md",attrs:{flat:"",label:"Confirmar",color:"positive"},on:{click:t.nextStep}}),i("q-btn",{attrs:{flat:"",label:"Cancelar",color:"amber-14"},on:{click:function(e){t.wndSending.state=!1}}})],1)],1)],1),i("q-footer",{staticClass:"bg-darkl1 text-white"},[t.finish.state?i("div",[i("q-btn-group",{attrs:{spread:""}},[i("q-btn",{staticClass:"q-py-md",attrs:{label:"Enviar a Caja",icon:"done",color:"positive"},on:{click:t.nextStep}}),i("q-btn",{attrs:{label:"Cancelar",icon:"cancel",color:"amber-14"},on:{click:function(e){t.finish.state=!1}}})],1)],1):i("div",{staticClass:"q-pa-xs row items-center"},[i("div",{staticClass:"col text-center"},[i("q-input",{staticClass:"text-uppercase",attrs:{filled:"",dark:"",autofocus:"",dense:"",label:"",color:"green-13"},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.codeDefine.apply(null,arguments)}},scopedSlots:t._u([{key:"prepend",fn:function(){return[i("q-btn",{attrs:{icon:"fas fa-hashtag",dense:"",rounded:""}})]},proxy:!0},{key:"label",fn:function(){return[i("q-icon",{attrs:{name:"search",size:"sm"}}),t._v(" barcode, Codigo o codigo corto\n                    ")]},proxy:!0}]),model:{value:t.definitor,callback:function(e){t.definitor=e},expression:"definitor"}})],1),i("q-btn",{attrs:{flat:"",icon:"fas fa-plus",stack:"","no-caps":"",color:"green-13"},on:{click:function(e){t.wndAdder.state=!0}}}),t.inbasket.length?i("q-btn",{attrs:{flat:"",icon:"fas fa-arrow-right",stack:"","no-caps":"",color:"green-13"},on:{click:function(e){t.wndSending.state=!0}}}):t._e()],1)])],1)},a=[],r=s("5542"),o=s("b293"),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-card",{staticClass:"bg-darkl1"},[s("q-card-section",[s("div",{staticClass:"row justify-between items-start text-h6 text-bold"},[s("div",{staticClass:"text-green-13"},[t._v(t._s(t.product.code))]),t.product.stocks?s("div",[s("q-btn",{staticClass:"text-bold",attrs:{flat:"",dense:"","no-caps":"",color:t.product.stocks[0].stock?"green-13":"amber-13",label:"Stock: "+t.product.stocks[0].stock}})],1):t._e(),s("div",{staticClass:"text-light-blue-13"},[t._v(t._s(t.product.name))])]),s("div",{staticClass:"text--2"},[t._v(t._s(t.product.description))])]),s("div",[t.product.prices.length?[t.showprices?["std"==t.productType?s("q-card-section",{staticClass:"text-center row justify-between q-px-md"},t._l(t.prices,(function(e){return s("div",{key:e.id,staticClass:"q-px-md q-py-sm",class:e.id==t.usedprice.id?"usedprice":""},[s("div",{staticClass:"text--2"},[t._v(t._s(e.alias))]),s("div",{staticClass:"text-bold"},[t._v("$ "+t._s(e.price))])])})),0):t._e(),"off"==t.productType?s("q-card-section",{staticClass:"text-center text-bold text-orange"},[s("div",[t._v("OFERTA")]),s("div",{staticClass:"text-h4"},[t._v("$ "+t._s(t.prices[0].price))])]):t._e()]:t._e(),s("q-card-section",[s("div",{staticClass:"row items-end"},[s("div",{staticClass:"text-center"},[s("div",{staticClass:"column"},[s("div",{staticClass:"text-cemter"},[t._v("Cantidad:")]),s("q-btn",{staticClass:"q-py-xs",attrs:{icon:"fas fa-chevron-up",flat:""},on:{click:t.ctrlPzsUp}}),s("div",{staticClass:"text-center col column q-py-md"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.amount,expression:"amount"}],staticClass:"text-center exo fieldcant",attrs:{type:"number",min:"1"},domProps:{value:t.amount},on:{input:function(e){e.target.composing||(t.amount=e.target.value)}}})]),s("q-btn",{staticClass:"q-py-xs",attrs:{icon:"fas fa-chevron-down",flat:""},on:{click:t.ctrlPzsDown}})],1)]),s("div",{staticClass:"col"},[s("q-markup-table",{staticClass:"col q-mx-md bg-none text-grey-5",attrs:{dark:"",flat:"",dense:"",square:""}},[s("tbody",[s("tr",[s("td",{attrs:{colspan:"2"}},[s("q-select",{attrs:{label:"Surtir por",borderless:"",dense:"",dark:"",color:"green-13","option-value":"id","option-label":"alias",options:t.metsupply.opts},model:{value:t.metsupply.model,callback:function(e){t.$set(t.metsupply,"model",e)},expression:"metsupply.model"}})],1)]),s("tr",[s("td",{attrs:{colspan:"2"}},[s("q-input",{attrs:{borderless:"",dense:"",dark:"",flat:"",label:"Notas",color:"green-13"},model:{value:t.comments,callback:function(e){t.comments=e},expression:"comments"}})],1)]),s("tr",[s("td",[t._v("Piezas X Caja")]),s("td",{attrs:{align:"right"}},[t._v(t._s(t.ipack))])]),s("tr",[s("td",[t._v("Cajas")]),s("td",{attrs:{align:"right"}},[t._v(t._s(t.boxes))])]),s("tr",[s("td",[t._v("Unidades")]),s("td",{attrs:{align:"right"}},[t._v(t._s(t.units))])]),t.showprices?[s("tr",[s("td",[t._v("Precio unitario")]),s("td",{attrs:{align:"right"}},[t._v(t._s(t.usedprice.price))])]),s("tr",[s("td",[t._v("Total")]),s("td",{staticClass:"text-green-13 text-bold",attrs:{align:"right"}},[t._v(t._s(t.usedprice.price*t.units))])])]:t._e()],2)])],1)])]),s("q-btn-group",{staticClass:"btn_focus",attrs:{spread:""}},[s("q-btn",{staticClass:"q-py-md",attrs:{load:t.actions.done.dis,dis:t.actions.done.dis,icon:"fas fa-check",color:"primary",autofocus:""},on:{click:t.confirm}})],1)]:[s("q-banner",{staticClass:"text-white bg-negative text-center"},[s("q-icon",{attrs:{name:"fas fa-exclamation-triangle",size:"md"}}),t._v(" Este producto no tiene precios!! :/\n                ")],1)]],2)],1)},d=[],c={props:{product:{type:Object,default:{}},action:{type:String,default:"add"},client:{type:Object,default:{}},showprices:{type:Boolean,default:!1},btnremove:{type:Boolean,default:!0}},data(){return{amount:1,comments:"",actions:{done:{dis:!1,load:!1},cancel:{dis:!1},remove:{dis:!1,rem:!1}},metsupply:{model:{alias:"Piezas",id:1},opts:[{alias:"Piezas",id:1},{alias:"Docenas",id:2},{alias:"Cajas",id:3}]},pricelists:[{id:1,alias:"MEN",name:"MENUDEO"},{id:2,alias:"MAY",name:"MAYOREO"},{id:3,alias:"DOC",name:"DOCENA"},{id:4,alias:"CAJ",name:"CAJA"}]}},mounted(){this.product.metsupply&&(this.metsupply.model=this.metsupply.opts.find((t=>t.id==this.product.metsupply.id)),this.amount=this.product.ordered.amount,this.comments=this.product.ordered.comments)},methods:{ctrlPzsUp(){this.amount++},ctrlPzsDown(){this.amount>1&&this.amount--},productRemove(){console.log(this.params),this.$emit("confirm",this.params)},confirm(){this.$emit("confirm",this.params)},remove(){this.$emit("remove")}},computed:{prices(){return this.product?this.product.prices:null},pricelistDefault(){return this.pricelists.find((t=>t.id==this.client._price_list))},productType(){if(this.prices.length){let t=this.prices[0].price,e=this.prices.filter((t=>t.id<=4)).filter((e=>t==e.price)).length==this.prices.length;return e?"off":"std"}return{error:!0,msg:"Producto sin precios"}},ipack(){return this.product.pieces?this.product.pieces:1},units(){switch(this.metsupply.model.id){case 2:return 12*this.amount;case 3:return this.amount*this.ipack;default:return this.amount}},boxes(){return(this.units/this.ipack).toFixed(1)},usedprice(){switch(this.metsupply.model.id){case 2:return this.prices.find((t=>3==t.id));case 3:return this.prices.find((t=>4==t.id));default:if("off"==this.productType)return this.prices.find((t=>1==t.id));if(this.amount<3)return this.prices.find((t=>1==t.id));if(this.amount>=3)return this.prices.find((t=>2==t.id));break}},params(){return{product:this.product,comments:this.comments,amount:this.amount,units:this.units,usedprice:this.usedprice,metsupply:this.metsupply.model}}}},l=c,p=(s("4f6a"),s("2877")),u=s("f09f"),m=s("a370"),h=s("9c40"),v=s("54e1"),f=s("0016"),_=s("2bb1"),b=s("ddd8"),C=s("27f9"),g=s("e7a9"),x=s("eebe"),w=s.n(x),k=Object(p["a"])(l,n,d,!1,null,"fe9dc4e4",null),y=k.exports;w()(k,"components",{QCard:u["a"],QCardSection:m["a"],QBtn:h["a"],QBanner:v["a"],QIcon:f["a"],QMarkupTable:_["a"],QSelect:b["a"],QInput:C["a"],QBtnGroup:g["a"]});var q={components:{ProductAutocomplete:o["a"],ProductAOE:y},data(){return{psocket:this.$sktPreventa,order:null,wndCounter:{state:!1,product:void 0},wndEditor:{state:!1,product:void 0},wndAdder:{state:!1,product:void 0},definitor:"",pricelists:[{id:1,alias:"MEN",name:"MENUDEO"},{id:2,alias:"MAY",name:"MAYOREO"},{id:3,alias:"DOC",name:"DOCENA"},{id:4,alias:"CAJ",name:"CAJA"}],metsupplies:[{name:"Piezas",id:1,alias:"pzs"},{name:"Docenas",id:2,alias:"dcs"},{name:"Cajas",id:3,alias:"cjs"}],finish:{state:!1},wndSending:{state:!1,step:1,serie:void 0,folio:void 0,persistent:!1}}},async mounted(){this.$store.commit("Preventa/setHeaderState",!1),this.$store.commit("Preventa/setFooterState",!1),this.$q.loading.show({message:"Cargando..."}),this.order=await r["a"].order(this.ordercatch),console.log(this.order),this.$q.loading.hide()},methods:{async productConfirm(t){console.log(t);let e=this.wndCounter.product,s={_product:t.product.id,_order:this.ordercatch.id,_supply_by:t.metsupply.id,amount:t.amount,comments:""},i=await r["a"].makeCheckout(s);i.error?(console.log(i.error),this.$q.notify({message:"Confirmacion erronea!",icon:"close",color:"negative"})):(e.ordered.amount=t.amount,e.ordered.toDelivered=t.amount,e.ordered.comments=t.comments,e.ordered.toDelivered=t.amount,e.ordered._supply_by=t.metsupply.id,this.$q.notify({message:"Producto Confirmado!!",position:"center",color:"positive",icon:"done"}),this.wndCounter.state=!1,this.wndCounter.product=void 0)},async productAdd(t){console.log(t);this.wndAdder.product;let e={_product:t.product.id,_order:this.ordercatch.id,_supply_by:t.metsupply.id,amount:t.amount,comments:""},s=await r["a"].makeCheckout(e);if(console.log(s),400==s.server_status)this.$q.notify({message:`Error: ${s.msg}`,color:"negative",icon:"fas fa-bug"});else{let t=s.data;console.log(t),this.order.products.unshift(t),this.wndAdder.product=void 0,this.wndAdder.state=!1}},async productEdit(t){console.log("El producto fue modificado, enviando actualizacion ... ",""),console.log(t);let e=this.wndEditor.product,s={_product:t.product.id,_order:this.ordercatch.id,_supply_by:t.metsupply.id,amount:t.amount,comments:""},i=await r["a"].makeCheckout(s);i.error?(console.log(i.error),this.$q.notify({message:"No se pudo actualizar el producto",icon:"close",color:"negative"})):(e.ordered.amount=t.amount,e.ordered.toDelivered=t.amount,e.ordered.comments=t.comments,e.ordered.toDelivered=t.amount,e.ordered._supply_by=t.metsupply.id,this.$q.notify({message:"Producto Actualizado!!",position:"center",color:"positive",icon:"done"}),this.wndEditor.state=!1,this.wndEditor.product=void 0)},codeDefine(){let t=this.definitor.toUpperCase(),e=this.products.find((e=>e.code==t||e.name==t));e?e.ordered.toDelivered?this.edit(e):this.confirm(e):(console.log("No encontrado en products, Abrir wndAdder"),this.wndAdder.state=!0,this.wndAdder.product=null),this.definitor=""},confirm(t){this.wndCounter.product=t,this.wndCounter.state=!0},edit(t){this.wndEditor.product=t,this.wndEditor.state=!0},setProduct(t){console.log(t),this.wndAdder.product=t},cleanCounter(){this.wndCounter.product=void 0},cleanEditor(){this.wndEditor.product=void 0},cleanAdder(){this.wndAdder.product=void 0},async nextStep(){this.$q.loading.show({message:"Creando folio..."});let t={_order:this.ordercatch.id},e=await r["a"].nextStep(t);if(console.log(e),e.err)this.$q.notify({message:e.err,color:"negative",icon:"fas fa-exclamation-triangle"}),this.$q.loading.hide();else{console.log(e.status);e.status[e.status.length-1];this.$router.push("/preventa/checkout"),this.$q.notify({message:"OK!!!",color:"positive",icon:"done"}),this.$q.loading.hide()}}},beforeDestroy(){this.$store.commit("Preventa/setHeaderState",!0),this.$store.commit("Preventa/setFooterState",!0)},computed:{ordercatch(){return this.$route.params},products(){return this.order?this.order.products.map((t=>(t.ipack=t.pieces?t.pieces:1,t.pricelistDefault=this.pricelists.find((t=>t.id==this.order.client._price_list)),t.metsupply=(t=>this.metsupplies.find((e=>e.id==t.ordered._supply_by)))(t),t.productType=(t=>{if(t.prices.length){let e=t.prices[0].price,s=t.prices.filter((t=>t.id<=4)).filter((t=>e==t.price)).length==t.prices.length;return s?"off":"std"}return{error:!0,msg:"Producto sin precios"}})(t),t.units=(t=>{switch(t.ordered._supply_by){case 2:return 12*t.ordered.amount;case 3:return t.ordered.amount*t.ipack;default:return t.ordered.amount}})(t),t.boxes=(t=>(t.units/t.ipack).toFixed(1))(t),t.usedprice=(t=>{switch(t.ordered._supply_by){case 2:return t.prices.find((t=>3==t.id));case 3:return t.prices.find((t=>4==t.id));default:if("off"==t.productType)return t.prices.find((t=>1==t.id));if(t.ordered.amount<3)return t.prices.find((t=>1==t.id));if(t.ordered.amount>=3)return t.prices.find((t=>2==t.id));break}})(t),t.total=t.units*t.usedprice.price,t))):[]},outbasket(){return this.products.filter((t=>!t.ordered.toDelivered))},inbasket(){return this.products.filter((t=>t.ordered.toDelivered))},totalBasket(){return this.inbasket.length?this.inbasket.reduce(((t,e)=>e.total+t),0):0},totalOutBasket(){return this.outbasket.length?this.outbasket.reduce(((t,e)=>e.total+t),0):0},pzsBasket(){return this.inbasket.length?this.inbasket.reduce(((t,e)=>parseInt(e.units)+t),0):0},bxsBasket(){return this.inbasket.length?this.inbasket.reduce(((t,e)=>parseInt(e.boxes)+t),0):0}}},A=q,$=(s("3039"),s("9989")),E=s("e359"),P=s("068f"),O=s("24e8"),D=s("7ff0"),z=Object(p["a"])(A,i,a,!1,null,"45bdb755",null);e["default"]=z.exports;w()(z,"components",{QPage:$["a"],QHeader:E["a"],QBtn:h["a"],QIcon:f["a"],QImg:P["a"],QDialog:O["a"],QCard:u["a"],QCardSection:m["a"],QBtnGroup:g["a"],QFooter:D["a"],QInput:C["a"]})},d3b1:function(t,e,s){t.exports=s.p+"img/_defprod_.2073f27f.png"},f77e:function(t,e,s){},fb00:function(t,e,s){}}]);