(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[11],{3706:function(t,e,o){"use strict";o("f730")},ab74:function(t,e,o){"use strict";o.r(e);var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-layout",{attrs:{view:"lHh Lpr lFf"}},[o("q-page-container",{staticClass:"exo bg-darkl0 text-grey-5"},[t.layout.header.state?o("q-header",{staticClass:"bg-none"},[o("q-card",{staticClass:"bg-darkl1"},[o("HeaderApp",{attrs:{title:t.layout.header.title}}),o("div",{staticClass:"bg-darkl1 q-pa-sm col row justify-between"},[o("div",{staticClass:"col-md-12 col-xs-12 items-end justify-end col"},[o("RangeDates",{on:{inputRanges:t.loadView}})],1)])],1)],1):t._e(),o("router-view"),t.layout.footer.state?o("q-footer",{staticClass:"bg-darktransl0",attrs:{reveal:""}},[o("ToolbarModule",{attrs:{with_home:!0}})],1):t._e()],1)],1)},s=[],r=(o("e01a"),o("b0fc")),a=o("7538"),n=o("1670"),d=o("bd9f"),l={name:"Resurtido",components:{ToolbarModule:r["a"],RangeDates:a["a"],HeaderApp:n["a"]},data(){return{flagPermissions:!0,flag:!0,dialog:!1,date:void 0,index:[],rsocket:this.$sktRestock}},created(){this.rsocket.disconnect(),this.rsocket.connect(),this.rsocket.on("joineddashreq",(t=>{this.sktJoinatRes(t)})),this.rsocket.on("creating",(t=>{this.sktCreateOrd(t)})),this.rsocket.on("order_update",(t=>{this.sktUpdateOrd(t)})),this.rsocket.on("order_changestate",(t=>{this.sktChangeState(t)})),this.rsocket.emit("joinat",{profile:this.profile,workpoint:this.workin.workpoint,room:this.socketroom})},methods:{async loadView(t){this.$q.loading.show({message:"Cargando vista..."});let e={date_from:t.dbranges.from,date_to:t.dbranges.to};this.$store.commit("Requisitions/todayState",this.timeToday(t.ranges.date.from));let o={params:e};console.log(o),this.index=await d["a"].index(o);let i=this.index.requisitions;console.log(this.index);let s=await d["a"].dashboard(o);s.requisitions.length>=0&&this.checkPermissions?(this.index.requisitions=[],s.requisitions.forEach((t=>this.index.requisitions.push(t))),this.flag=!(i.length>0),i.length<=0?(this.dialog=!0,this.$store.commit("Requisitions/startState",this.index)):(this.dialog=!1,this.$store.commit("Requisitions/startState",this.index))):(s.requisitions.forEach((t=>this.index.requisitions.push(t))),this.flag=!(i.length>0),i.length<=0?(this.dialog=!0,this.$store.commit("Requisitions/startState",this.index)):(this.dialog=!1,this.$store.commit("Requisitions/startState",this.index))),this.$q.loading.hide()},sktJoinatRes(t){console.log(`%cSe unio a Resurtido ${t.user.me.nick}`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},sktCreateOrd(t){let e=t.order,o=t.user.me;console.log(`%c${o.nick} esta creando la orden ${e.id}`,"background:#303952;color:#e66767;border-radius:10px;padding:8px;");let i=!1;console.log(this.cedisValidate(this.workin).length),1==t.order.status.id&&-1!=this.getValidateSounds(t.order)&&this.appsounds.ok.play(),t.order.from.id==this.workin.workpoint.id&&(this.$store.commit("Requisitions/newOrder",e),i=!0),!this.cedisValidate(this.workin).length||i||this.$store.commit("Requisitions/newOrder",e)},sktChangeState(t){console.log(t);let e={state:t.state,log:t.log},o=t.order;o.log=t.log,o.status=t.state,console.log(t.order.from.id),console.log(t.from.workpoint.id),console.log(t.state.id<=9&&t.order.from.id==t.from.workpoint.id),10==t.state.id&&-1!=this.getValidateSounds(t.order)&&this.appsounds.ok.play(),t.state.id>=3&&t.state.id<=9&&-1!=this.getValidateSounds(t.order)&&(this.appsounds.moved.play(),this.$q.notify({message:`La Orden ${t.order.id} ha cambiado su estatus a ${t.state.name}.`,color:"positive",icon:"done",position:"top-right"})),console.log(`%cLa orden ${t.order.id} cambio su status a ${t.state.name}`,"background:#7158e2;color:#fffa65;border-radius:10px;padding:8px;"),this.$store.commit("Requisitions/updateState",{order:o,newState:e})},sktUpdateOrd(t){if(console.log(t),null==t.product){let e=t.order;console.log(`%cLa orden ${e.id} no añadio el producto seleccionado.`,"background:#7158e2;color:#fffa65;border-radius:10px;padding:8px;")}else{let e=t.order,o=t.product,i="remove"==t.cmd?"removio":"añadio";console.log(`%cLa orden ${e.id} ${i} ${o.description}`,"background:#7158e2;color:#fffa65;border-radius:10px;padding:8px;")}}},beforeDestroy(){console.log("%cDesconectando de resurtido...","background:#F97F51;color:#2C3A47;border-radius:10px;padding:6px;"),this.rsocket.emit("unjoin",{profile:this.profile,workpoint:this.workin.workpoint,room:"main"}),this.rsocket.off()},computed:{timeToday(){return t=>this.$moment().format("YYYY-MM-DD")===t},cedisValidate(){return t=>[t].filter((t=>1==t.workpoint.id||2==t.workpoint.id||16==t.workpoint.id))},getValidateSounds(){return t=>this.$store.getters["Requisitions/getIDX"](t)},appsounds(){return this.$store.getters["Multimediapp/sounds"]},workin(){return this.$store.getters["Account/workin"]},socketroom(){return this.profile.me._rol<=3?"admin":"orders"},profile(){return this.$store.getters["Account/profile"]},layout(){return this.$store.state.Requisitions.layout},checkPermissions(){let t=JSON.parse(localStorage.getItem("workin")),e=[1,2,16,18];return!!e.includes(t.workpoint.id)}}},c=l,u=(o("3706"),o("2877")),h=o("4d5a"),p=o("09e3"),g=o("e359"),m=o("f09f"),f=o("24e8"),k=o("a370"),w=o("eb85"),b=o("4b7e"),$=o("9c40"),x=o("7ff0"),q=o("7f67"),y=o("eebe"),R=o.n(y),S=Object(u["a"])(c,i,s,!1,null,null,null);e["default"]=S.exports;R()(S,"components",{QLayout:h["a"],QPageContainer:p["a"],QHeader:g["a"],QCard:m["a"],QDialog:f["a"],QCardSection:k["a"],QSeparator:w["a"],QCardActions:b["a"],QBtn:$["a"],QFooter:x["a"]}),R()(S,"directives",{ClosePopup:q["a"]})},f730:function(t,e,o){}}]);