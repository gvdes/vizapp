(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[35],{c738:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("q-page",{attrs:{padding:""}},[e("q-header",{staticClass:"bg-darkl1 q-py-sm",attrs:{elevated:""}},[e("div",{staticClass:"row items-center"},[e("div",{staticClass:"col"},[e("q-btn",{attrs:{flat:"",icon:"fas fa-chevron-left",color:"white"},on:{click:function(e){return t.$router.push("/almacen/contador")}}})],1),e("div",{staticClass:"text-center col"},[e("span",[t._v("INVENTARIO "+t._s(this.$route.params.id))]),e("span",{staticClass:"text-grey"},[t._v(" ConfiguraciÃ³n")])]),e("div",{staticClass:"col text-right q-pr-sm"},[!t.ismobile&&t.data?[t.trydiscard?t._e():e("q-btn",{attrs:{flat:"","no-caps":"",color:"pink-13",icon:"inventory_2"},on:{click:function(e){t.trydiscard=!0}}}),t.trydiscard?[e("q-btn",{attrs:{"no-caps":"",flat:"",rounded:"",color:"pink-13",icon:"inventory",label:"Archivar Inventario!!"},on:{click:function(e){return t.nextStep(4)}}}),e("q-btn",{attrs:{"no-caps":"",unelevated:"",rounded:"",color:"primary",icon:"close ",label:"Cancelar"},on:{click:function(e){t.trydiscard=!1}}})]:t._e(),t.data&&1==t.data.inventory.status.id&&t.canStart&&!t.trydiscard?[e("transition",{attrs:{appear:"","enter-active-class":"animated rubberBand slower","leave-active-class":"animated zoomOut"}},[e("q-btn",{attrs:{flat:"","no-caps":"",color:"green-13",icon:"fas fa-play-circle"},on:{click:t.start}})],1)]:t._e(),t.data&&2==t.data.inventory.status.id&&!t.trydiscard?[e("q-btn",{attrs:{rounded:"",flat:"",color:"green-13",icon:"launch"},on:{click:function(e){return t.$router.push(`contador/${t.inv.id}`)}}})]:t._e()]:t._e()],2)])]),t.data?[e("q-card",{staticClass:"q-mt-xs bg-darkl1 exo"},[e("q-card-section",[t._v("\n                Creacion: "+t._s(t.data.inventory.created_at)),e("br"),t._v("\n                Administrador: "+t._s(t.data.inventory.created_by.names)+" "+t._s(t.data.inventory.created_by.surname_pat)+" [ "+t._s(t.data.inventory.created_by.nick)+" ]"),e("br")])],1),e("div",{class:`${t.wrapperClass} q-pt-md q-mb-xl q-gutter-md`},[e("q-card",{staticClass:"col bg-darkl1 exo"},[e("q-expansion-item",{attrs:{"expand-separator":"",icon:"fas fa-users",label:"Responsables",caption:t.group.length.toString(),"header-class":"text-grey-5"},model:{value:t.expands.team,callback:function(e){t.$set(t.expands,"team",e)},expression:"expands.team"}},[e("q-card-section",[e("q-list",t._l(t.natAccounts,(function(a){return e("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:a.id,attrs:{tag:"label"}},[e("q-item-section",{attrs:{avatar:""}},[e("q-checkbox",{attrs:{disable:1!=t.data.inventory.status.id,dark:"",val:a.id,color:"green-13"},on:{input:function(e){return t.toggleReponsable(a.id)}},model:{value:t.group,callback:function(e){t.group=e},expression:"group"}})],1),e("q-item-section",[e("q-item-label",[e("span",{staticClass:"text-grey-6"},[t._v(t._s(`${a.names} ${a.surname_pat}`))]),e("br"),t._v("\n                                        [ "+t._s(a.nick.toLowerCase())+" ]\n                                    ")])],1)],1)})),1)],1)],1)],1),1==t.data.inventory.status.id?e("q-card",{staticClass:"col bg-darkl1 exo"},[e("q-expansion-item",{attrs:{"expand-separator":"",icon:"fab fa-searchengin",label:"Seleccion de productos","header-class":"text-grey-5"},model:{value:t.expands.seeker,callback:function(e){t.$set(t.expands,"seeker",e)},expression:"expands.seeker"}},[e("q-card-section",[e("div",{staticClass:"row items-start"},[1==t.data.inventory.status.id?e("div",{staticClass:"col"},[e("q-select",{attrs:{dark:"",dense:"",flat:"",color:"green-13",label:"Agregar por...","stack-label":"",options:t.optsAddProds},on:{input:t.modeAddChanged},model:{value:t.modeAdd,callback:function(e){t.modeAdd=e},expression:"modeAdd"}})],1):t._e()])]),t.modeAdd?e("q-card-section",[1==t.modeAdd.value?e("CategoriesBrowser",{on:{selectedCat:t.selectedCat}}):t._e(),2==t.modeAdd.value?e("WarehousesBrowser",{on:{selectedLoc:t.selectedLoc}}):t._e(),3==t.modeAdd.value?e("div",[e("ProductAutocomplete")],1):t._e()],1):t._e(),e("q-card-section",{staticStyle:{"max-width":"100%"}},[e("q-table",{attrs:{dark:"",flat:"","card-class":"bg-none",data:t.listSeekers,columns:t.tableSeekers.columns,"visible-columns":t.tableSeekers.visibleColumns},scopedSlots:t._u([{key:"body",fn:function(a){return[e("q-tr",{attrs:{props:a}},[e("q-td",{key:"id",attrs:{props:a}},[t._v(t._s(a.row.id))]),e("q-td",{key:"code",attrs:{props:a}},[t._v(t._s(a.row.code))]),e("q-td",{key:"description",staticClass:"text--2",attrs:{props:a}},[t._v(t._s(a.row.description))]),e("q-td",{key:"locations",attrs:{props:a}},[a.row.locations.length?e("span",[e("span",{staticClass:"text-light-blue text-bold"},[t._v("[ "+t._s(a.row.locations.length)+" ]")]),t._v("\n                                            "+t._s(a.row.locations.map((t=>t.path)).join(", "))+"\n                                        ")]):t._e()])],1)]}}],null,!1,1959157716)})],1),t.listSeekers.length?e("div",{staticClass:"row"},[e("q-btn",{staticClass:"col q-pa-sm",attrs:{flat:"",label:"Limpiar",color:"amber-13","no-caps":""}}),e("q-btn",{staticClass:"col q-pa-sm",attrs:{flat:"",label:"Agregar a la Lista",color:"green-13","no-caps":""},on:{click:t.dragProducts}})],1):t._e()],1)],1):t._e(),e("q-card",{staticClass:"col bg-darkl1 exo"},[e("q-expansion-item",{attrs:{"expand-separator":"",icon:"list_alt",label:"Productos","header-class":"text-grey-5"},model:{value:t.expands.products,callback:function(e){t.$set(t.expands,"products",e)},expression:"expands.products"}},[e("q-card-section",[e("q-table",{attrs:{dark:"",flat:"","card-class":"bg-none",data:t.listProducts,columns:t.tableProducts.columns,"visible-columns":t.tableProducts.visibleColumns},scopedSlots:t._u([{key:"body",fn:function(a){return[e("q-tr",{attrs:{props:a}},[e("q-td",{key:"id",attrs:{props:a}},[t._v(t._s(a.row.id))]),e("q-td",{key:"code",attrs:{props:a}},[t._v(t._s(a.row.code))]),e("q-td",{key:"description",staticClass:"text--2",attrs:{props:a}},[t._v(t._s(a.row.description))]),e("q-td",{key:"locations",attrs:{props:a}},[a.row.locations.length?e("span",[e("span",{staticClass:"text-green-13 text-bold"},[t._v("[ "+t._s(a.row.locations.length)+" ]")]),t._v("\n                                            "+t._s(a.row.locations.map((t=>t.path)).join(", "))+"\n                                        ")]):t._e()])],1)]}}],null,!1,2805601837)})],1),t.listProducts.length&&1==t.data.inventory.status.id?e("div",{staticClass:"row"},[e("q-btn",{staticClass:"col q-pa-sm",attrs:{flat:"",label:"Limpiar",color:"amber-13","no-caps":""},on:{click:t.clearAddeds}})],1):t._e()],1)],1)],1)]:t._e(),t.ismobile?e("q-footer",{staticClass:"bg-darkl1",attrs:{elevated:""}},[e("div",{staticClass:"q-pa-sm row items-center justify-between"},[t.trydiscard?t._e():e("q-btn",{attrs:{flat:"","no-caps":"",color:"pink-13",icon:"inventory_2"},on:{click:function(e){t.trydiscard=!0}}}),t.trydiscard?[e("q-btn",{attrs:{"no-caps":"",unelevated:"",rounded:"",color:"primary",icon:"close ",label:"Cancelar"},on:{click:function(e){t.trydiscard=!1}}}),e("q-btn",{attrs:{"no-caps":"",flat:"",rounded:"",color:"pink-13",icon:"inventory",label:"Archivar Inventario!!"},on:{click:function(e){return t.nextStep(4)}}})]:t._e(),t.data&&1==t.data.inventory.status.id&&t.canStart&&!t.trydiscard?[e("transition",{attrs:{appear:"","enter-active-class":"animated rubberBand slower","leave-active-class":"animated zoomOut"}},[e("q-btn",{attrs:{flat:"","no-caps":"",color:"green-13",icon:"fas fa-play-circle"},on:{click:t.start}})],1)]:t._e(),t.data&&2==t.data.inventory.status.id&&!t.trydiscard?[e("q-btn",{attrs:{rounded:"",flat:"",color:"green-13",icon:"launch"},on:{click:function(e){return t.$router.push(`contador/${t.inv.id}`)}}})]:t._e()],2)]):t._e()],2)},o=[],n=a("e0df"),r=a("c4e4"),i=a("b293"),l=a("7908"),c=a("a647"),d={components:{ProductAutocomplete:i["a"],CategoriesBrowser:l["a"],WarehousesBrowser:c["a"]},data(){return{data:null,natAccounts:null,trydiscard:!1,group:[],optsAddProds:[{label:"Categoria",value:1,disable:!0},{label:"Ubicacion",value:2,disabled:!1},{label:"Individual",value:3,disable:!0}],modeAdd:null,listProducts:[],tableProducts:{columns:[{name:"id",align:"left",label:"ID",field:t=>t.id,sortable:!0},{name:"code",align:"left",label:"Codigo",field:t=>t.code,sortable:!0},{name:"description",align:"left",label:"Descripcion",field:t=>t.description},{name:"locations",align:"center",label:"Ubicaciones",field:t=>t.locations.length,sortable:!0}],visibleColumns:["code","locations"]},listSeekers:[],tableSeekers:{columns:[{name:"id",align:"left",label:"ID",field:t=>t.id,sortable:!0},{name:"code",align:"left",label:"Codigo",field:t=>t.code,sortable:!0},{name:"description",align:"left",label:"Descripcion",field:t=>t.description},{name:"locations",align:"center",label:"Ubicaciones",field:t=>t.locations.length,sortable:!0}],visibleColumns:["code","locations"]},expands:{team:!0,seeker:!0,products:!0},settings:new Object,__accounts:[]}},async beforeMount(){localStorage.removeItem("statelocator"),this.$store.commit("Layout/hideToolbarModule"),this.data=await n["a"].find(this.$route.params.id),this.listProducts=this.data.inventory.products,this.getAccounts()},methods:{getAccounts(){r["a"].list({_rol:[6,7,8]}).then((t=>{console.log(t.data),this.natAccounts=t.data.map((t=>(this.data.inventory.responsables.forEach((e=>{e.id==t.id&&this.group.push(t.id)})),t)))})).catch((t=>{console.log(t)}))},toggleReponsable(t){let e={_responsable:t,_inventory:this.$route.params.id};n["a"].toggleReponsable(e).then((t=>{console.log(t.data),console.log(this.group)})).catch((t=>{console.log(t)}))},selectedCat(t){console.log("Categoria Seleccionada"),this.settings.category=t.category,this.listSeekers=t.products.length?t.products:[],console.log(this.settings)},selectedLoc(t){console.log("Ubicacion seleccionada"),this.settings.warehouse=t.warehouse,this.settings.section=t.section?t.section.model.value:null,this.listSeekers=t.products.length?t.products:[]},async modeAddChanged(){this.settings=new Object,this.listSeekers=[],this.settings.addmode=this.modeAdd.value},dragProducts(){console.log("Arrastrando porductos!!"),this.listSeekers.forEach((t=>{this.listProducts.findIndex((e=>e.id==t.id))<0&&this.listProducts.unshift(t)}))},clearAddeds(){this.listProducts=[]},start(){console.log("Iniciando ");let t=this.listProducts.map((t=>t.id)),e={_products:t,_inventory:this.data.inventory.id,settings:this.settings};this.$q.loading.show({message:"Aplicando configuracion, porfavor espera..."}),console.log(e),n["a"].addProducts(e).then((t=>{this.nextStep()})).catch((t=>{console.log(t)}))},nextStep(t,e){let a=this.data.inventory.status,s="";console.log("Estatus Actual: "+a.id);let o=t||a.id+1;switch(o){case 2:s="Iniciando Inventario, espera...";break;case 3:s="Cerrando Inventario, esperaa..";break;case 4:s="Eliminando Inventario, espera...";break}this.$q.loading.show({message:s});let r={_inventory:this.data.inventory.id,_status:o};console.log("Cambiando status"),console.log(r),n["a"].nextStep(r).then((t=>{let e=t.data;console.log(e),this.data.inventory.status=e.order.status,this.notifyChangeState(e),this.$q.loading.hide()})).catch((t=>{console.log(t)}))},notifyChangeState(t){let e=t.order.status.id;switch(e){case 2:this.$q.notify({icon:"done",color:"positive",timeout:1200,message:"El inventario ya puede realizarse!!"}),this.$q.loading.show(),this.$router.push("/almacen/contador/"+t.order.id),this.$q.loading.hide();break;case 3:msgnewState="Cerrando Inventario, esperaa..";break;case 4:this.$q.notify({icon:"done",color:"positive",message:"El inventario ha sido eliminado!"}),this.$router.push("/almacen/contador");break}}},beforeDestroy(){this.$store.commit("Layout/showToolbarModule"),localStorage.removeItem("statelocator")},computed:{fullpath(){let t="";return this.warehouses.sectModels.forEach(((e,a,s)=>{e.value&&(t+=0==a?`${e.label}`:`-${e.label}`)})),t},ismobile(){return this.$q.platform.is.mobile},auths(){return this.$store.getters["Account/moduleauths"]},profile(){return this.$store.getters["Account/profile"]},canStart(){return this.listProducts.length&&this.group.length},wrapperClass(){return this.$q.platform.is.mobile?"column":"row items-start"}}},u=d,p=a("2877"),b=a("9989"),m=a("e359"),g=a("9c40"),h=a("f09f"),v=a("a370"),f=a("3b73"),y=a("1c1c"),_=a("66e5"),k=a("4074"),q=a("8f8e"),C=a("0016"),x=a("0170"),w=a("ddd8"),A=a("eaac"),S=a("bd08"),$=a("db86"),I=a("7ff0"),P=a("714f"),Q=a("eebe"),L=a.n(Q),E=Object(p["a"])(u,s,o,!1,null,null,null);e["default"]=E.exports;L()(E,"components",{QPage:b["a"],QHeader:m["a"],QBtn:g["a"],QCard:h["a"],QCardSection:v["a"],QExpansionItem:f["a"],QList:y["a"],QItem:_["a"],QItemSection:k["a"],QCheckbox:q["a"],QIcon:C["a"],QItemLabel:x["a"],QSelect:w["a"],QTable:A["a"],QTr:S["a"],QTd:$["a"],QFooter:I["a"]}),L()(E,"directives",{Ripple:P["a"]})}}]);