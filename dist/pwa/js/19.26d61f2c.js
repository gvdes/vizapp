(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[19],{1:function(t,o){},2648:function(t,o,e){"use strict";e.r(o);var n=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("q-page",{attrs:{padding:""}},[e("q-header",{staticClass:"bg-darkl1",attrs:{elevated:""}},[e("q-toolbar",[e("q-btn",{attrs:{flat:"",rounded:"",dense:"",icon:"keyboard_backspace",color:"white"},on:{click:function(o){return t.$router.push("/almacen/contador")}}}),t._v("\n            Inventario "+t._s(this.$route.params.id)+"\n        ")],1),e("q-separator"),e("q-toolbar",[e("q-linear-progress",{attrs:{rounded:"",dark:"",size:"15px",value:t.progress.value,color:"primary"}},[e("div",{staticClass:"absolute-center flex flex-center"},[e("q-badge",{attrs:{color:"none","text-color":"white",label:t.progress.label}})],1)])],1)],1),t.index?[e("q-card",{staticClass:"bg-darkl1 text-grey-5 exo"},[e("q-card-section",[e("q-table",{attrs:{dark:"",flat:"","card-class":"bg-none",data:t.tableProducts.rows,columns:t.tableProducts.columns,"visible-columns":t.tableProducts.visibleCols},scopedSlots:t._u([{key:"body",fn:function(o){return[e("q-tr",{attrs:{props:o}},[e("q-td",{key:"id",attrs:{props:o}},[t._v(t._s(o.row.id))]),e("q-td",{key:"code",attrs:{props:o}},[t._v("\n                                "+t._s(o.row.code)+"\n                                "),e("br"),e("span",{staticClass:"text--2 text-grey-6"},[t._v(t._s(o.row.description))])]),e("q-td",{key:"description",attrs:{props:o}},[t._v(t._s(o.row.description))]),e("q-td",{key:"locations",attrs:{props:o}},[t._v(t._s(o.row._locations))]),e("q-td",{key:"counter",attrs:{props:o}},[t._v(t._s(o.row.counter))]),e("q-td",{key:"state",attrs:{props:o}},[1==o.row.state?[e("q-icon",{attrs:{name:"done",color:"green-13",size:"sm"}})]:t._e(),2==o.row.state?[e("q-spinner-dots",{attrs:{color:"amber-13",size:"sm"}}),e("br"),t.countingrespo?e("span",{staticClass:"text-amber-12 text--2"},[t._v("("+t._s(t.countingrespo.me.nick)+")")]):t._e()]:t._e(),3==o.row.state?[e("q-btn",{attrs:{size:"sm",flat:"",rounded:"",color:"amber-13",icon:"fas fa-pencil-alt"},on:{click:function(e){return t.counter(o)}}})]:t._e()],2)],1)]}}],null,!1,1977989852)})],1)],1),e("q-dialog",{attrs:{position:"bottom",persistent:""},model:{value:t.wndCounter.state,callback:function(o){t.$set(t.wndCounter,"state",o)},expression:"wndCounter.state"}},[null!=t.wndCounter.idxrow?e("q-card",{staticClass:"bg-darkl0 text-grey-5 exo"},[e("q-card-section",[t._v("\n                    "+t._s(t.tableProducts.rows[t.wndCounter.idxrow].code)),e("br"),e("span",{staticClass:"text--2"},[t._v(t._s(t.tableProducts.rows[t.wndCounter.idxrow].description))])]),e("q-separator"),e("q-card-section",{staticClass:"q-gutter-md"},[t._l(t.tableProducts.rows[t.wndCounter.idxrow].locations,(function(o,n){return e("q-input",{key:n,attrs:{dark:"",color:"green-13",autofocus:0==n,min:"0",type:"number"},scopedSlots:t._u([{key:"prepend",fn:function(){return[e("span",{staticClass:"text--2"},[t._v(t._s(o.path)+" :")])]},proxy:!0}],null,!0),model:{value:t.wndCounter.counters[n],callback:function(o){t.$set(t.wndCounter.counters,n,o)},expression:"wndCounter.counters[idx]"}})})),t.tableProducts.rows[t.wndCounter.idxrow].locations.length>1?e("div",[t._v("Total: "+t._s(t.counterToSave))]):t._e()],2),e("q-card-actions",{attrs:{align:"around"}},[e("q-btn",{attrs:{label:"Cancelar",flat:"",rounded:"",color:"light-blue-13","no-caps":""},on:{click:t.counterCancel}}),t.wndCounter.counters.length?[e("q-btn",{attrs:{flat:"","no-caps":"",rounded:"",color:"green-13",label:"Guardar",disable:t.wndCounter.saving,loading:t.wndCounter.saving},on:{click:t.save}})]:t._e()],2)],1):t._e()],1),t.imCreator?[1==t.progress.value?e("q-page-sticky",{attrs:{position:"bottom-right",offset:[10,10]}},[e("q-btn",{staticClass:"bg-darkl1 text-green-13",attrs:{rounded:"",icon:"done",label:"Terminar","no-caps":""},on:{click:t.terminate}})],1):t._e()]:t._e()]:t._e()],2)},s=[],r=(e("13d5"),e("e6cf"),e("8055")),i=e.n(r),a=e("e0df"),c=e("007d"),l={data(){return{index:null,tableProducts:{rows:[],visibleCols:["code","locations","counter","state"],columns:[{name:"id",align:"left",label:"ID",field:t=>t.id,sortable:!0},{name:"code",align:"left",label:"Codigo",field:t=>t.code,sortable:!0},{name:"locations",align:"center",label:"Ubicaciones",field:t=>t._locations,sortable:!0},{name:"counter",align:"center",label:"Conteo",field:t=>t.counter,sortable:!0},{name:"state",align:"center",label:"Estatus",field:t=>t.state,sortable:!0}]},productsRefresh:[],socket:null,imCreator:!1,wndCounter:{state:!1,idxrow:null,counters:[],saving:!1,stateIfCancel:null},sktcounter:null,countingrespo:null,joined:!1}},async beforeMount(){this.$store.commit("Layout/hideToolbarModule"),this.$q.loading.show({message:"Validando...",spinner:c["a"],spinnerColor:"green-13"}),this.index=await a["a"].find(this.$route.params.id),console.log(this.index),this.index.success?this.stay()?(console.log("Acceso Exitoso!!, formateando filas..."),this.index.inventory.products.forEach((t=>{t.state=t.ordered.details.settings?1:3,t._locations=t.locations.map((t=>t.path)).join(", "),t.counter=t.ordered.stocks_acc,this.tableProducts.rows.unshift(JSON.parse(JSON.stringify(t)))})),console.log("... LISTO!!!"),console.log(`Uniendo al ROOM ${this.socketroom}...`),this.sktcounter=await i()(this.$vsocket+"/counters"),this.sktcounter.emit("joinat",{room:this.socketroom,user:this.profile}),this.sktcounter.on("joined",(t=>{this.sktjoined(t)})),this.sktcounter.on("counting",(t=>{this.sktcounting(t)})),this.sktcounter.on("cancelcounting",(t=>{this.sktcancelcounting(t)})),this.sktcounter.on("countingconfirmed",(t=>{this.sktcountingconfirmed(t)}))):this.notifyExclution():this.notify404(),this.$q.loading.hide()},beforeDestroy(){this.$store.commit("Layout/showToolbarModule")},methods:{sktcountingconfirmed(t){console.log("%cSe ha confirmado un conteo!!!","font-size:2em;color:gold"),console.log(t);let o=this.tableProducts.rows.findIndex((o=>o.id==t.product.id));this.tableProducts.rows[o].state=1,this.tableProducts.rows[o].counter=t.settings.stock},sktjoined(t){console.log("Usuario conectado al conteo"),console.log(t),t.me.id!=this.profile.me.id&&this.$q.notify({color:"dark",message:t.me.nick+" se ha unido al conteo",position:"bottom-left",textColor:"green-13",timeout:1200,avatar:"https://cdn.quasar.dev/img/boy-avatar.png"})},sktcounting(t){console.log("Contando elemento..."),console.log(t);let o=this.tableProducts.rows.findIndex((o=>o.id==t.product.id));this.countingrespo=t.by,this.tableProducts.rows[o].state=2},sktcancelcounting(t){console.log("Cancelando elemento de forma remota"),console.log(t);let o=this.tableProducts.rows.findIndex((o=>o.id==t.product.id));this.tableProducts.rows[o].state=3,this.countingrespo=null},terminate(t,o){this.$q.loading.show({message:"Finalizando Inventario, espera..."}),console.log(this.index.inventory.id);let e={_inventory:this.index.inventory.id,_status:3};console.log("Ejecutando NextStep..."),console.log(e),a["a"].nextStep(e).then((t=>{let o=t.data;console.log(o),this.productsRefresh=o.order.products,this.$q.loading.hide()})).catch((t=>{console.log(t)}))},save(){this.wndCounter.saving=!0,this.tableProducts.rows[this.wndCounter.idxrow].counter=this.counterToSave,this.tableProducts.rows[this.wndCounter.idxrow].state=1;let t=this.tableProducts.rows[this.wndCounter.idxrow],o={_product:t.id,_inventory:this.index.inventory.id,stock:this.counterToSave,settings:{locs:t.locations,values:this.wndCounter.counters,modified:!0}};a["a"].rowCount(o).then((e=>{let n=e.data;console.log(n),this.$q.notify({color:"positive",icon:"done",position:"center",timeout:1e3,message:"Guardado!"}),console.log("%cConfirmando conteo...!!!","font-size:2em;color:gold"),this.sktcounter.emit("countingconfirmed",{room:this.socketroom,product:t,by:this.profile,settings:o}),this.counterReset(),this.wndCounter.state=!1})).catch((t=>{console.log(t)}))},counterCancel(){console.log("Se ha Cancelado el Contador"),this.tableProducts.rows[this.wndCounter.idxrow].state=this.wndCounter.stateIfCancel,this.sktcounter.emit("cancelcounting",{room:this.socketroom,by:this.profile,product:this.tableProducts.rows[this.wndCounter.idxrow]}),this.counterReset(),this.wndCounter.state=!1},counter(t){console.log(t);let o=t.key,e=this.tableProducts.rows.findIndex((t=>t.id==o));this.wndCounter.stateIfCancel=this.tableProducts.rows[e].state,this.tableProducts.rows[e].state=2,this.wndCounter.idxrow=e,this.wndCounter.state=!0;let n=this.tableProducts.rows[e];this.sktcounter.emit("counting",{room:this.socketroom,product:n,by:this.profile})},counterReset(){this.wndCounter.idxrow=null,this.wndCounter.counters=[],this.wndCounter.saving=!1,this.countingrespo=null},stay(){if(this.index.inventory.created_by.id==this.profile.me.id)return this.imCreator=!0,!0;{let t=this.index.inventory.responsables.findIndex((t=>t.id==this.profile.me.id));return t>=0}},notifyExclution(){this.$q.notify({message:"Raios!!, No eres miembro de este conteo!!",icon:"fas fa-sad-cry",timeout:1e3,color:"negative",position:"top"}),this.$router.push("/almacen/contador")},notify404(){this.$q.notify({message:`Raios!!, el folio ${this.$route.params.id} no existe!!`,icon:"fas fa-sad-cry",timeout:1e3,color:"negative",position:"top"}),this.$router.push("/almacen/contador")},buildPDF(){console.log("%cConstruyen Documento...","font-size:2em;color:orange;")}},computed:{profile(){return this.$store.getters["Account/profile"]},rowsDone(){return this.tableProducts.rows.filter((t=>null!=t.counter))},progress(){let t=0,o=this.tableProducts.rows.length,e=this.rowsDone.length,n=this.index?parseFloat((100*e/o).toFixed(2)):0,s=`${e} de ${o} : ${n}%`;return t=parseFloat(n/100).toFixed(2),{label:s,value:parseFloat(t)}},counterToSave(){return null!=this.wndCounter.idxrow?this.wndCounter.counters.reduce(((t,o)=>t+parseInt(o)),0):null},ismobile(){return this.$q.platform.is.mobile},socketroom(){return"COUNTER"+this.$route.params.id}}},d=l,u=e("2877"),h=e("9989"),p=e("e359"),g=e("65c6"),b=e("9c40"),m=e("eb85"),w=e("6b1d"),f=e("58a81"),C=e("f09f"),v=e("a370"),x=e("eaac"),k=e("bd08"),y=e("db86"),_=e("0016"),q=e("8380"),P=e("24e8"),$=e("27f9"),Q=e("4b7e"),S=e("de5e"),I=e("eebe"),T=e.n(I),R=Object(u["a"])(d,n,s,!1,null,null,null);o["default"]=R.exports;T()(R,"components",{QPage:h["a"],QHeader:p["a"],QToolbar:g["a"],QBtn:b["a"],QSeparator:m["a"],QLinearProgress:w["a"],QBadge:f["a"],QCard:C["a"],QCardSection:v["a"],QTable:x["a"],QTr:k["a"],QTd:y["a"],QIcon:_["a"],QSpinnerDots:q["a"],QDialog:P["a"],QInput:$["a"],QCardActions:Q["a"],QPageSticky:S["a"]})},e0df:function(t,o,e){"use strict";var n=e("31b8");o["a"]={index(){return n["b"].get("inventory").then((t=>t.data)).catch((t=>{console.log(t)}))},find(t){return n["b"].get("inventory/"+t).then((t=>t.data)).catch((t=>{console.log(t)}))},create(t){return n["b"].post("inventory",t)},toggleReponsable(t){return n["b"].post("inventory/responsable",t)},addProducts(t){return n["b"].post("inventory/add",t)},nextStep(t){return n["b"].post("inventory/next",t)},rowCount(t){return n["b"].post("inventory/value",t)}}}}]);