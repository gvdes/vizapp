(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"42c0":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t._self._c;return e("q-page",[e("q-header",{staticClass:"bg-darkl1",attrs:{elevated:""}},[e("div",{staticClass:"row items-start justify-between"},[e("q-btn",{attrs:{icon:"close",flat:""},on:{click:function(e){return t.$router.push("/preventa/pedidos")}}}),e("div",{staticClass:"col"},[e("div",{staticClass:"text--3 bg-dark q-pt-sm text-grey-5 text-center"},[t._v("PREVENTA / "+t._s(t.workin.workpoint.alias))]),e("div",{staticClass:"row items-center bg-dark divclient _client"},[e("div",{staticClass:"q-pa-xs col text-center"},[e("div",{staticClass:"text--3"},[t._v("Cliente:")]),e("div",{staticClass:"text-uppercase text--1"},["STD"!=t.client.type?e("q-icon",{staticClass:"q-mr-sm",attrs:{name:"fas fa-medal"}}):t._e(),t._v(" "+t._s("STD"==t.client.type?t.client.name:`${t.client.name} (${t.client.id})`)+"\n                            ")],1)]),e("div",{staticClass:"q-pa-xs col text-center"},[e("div",{staticClass:"text--3"},[t._v("Folio:")]),e("div",{staticClass:"text-bold text---1"},[t._v(t._s(t.ordercatch.id))]),t.haveparent?e("div",{staticClass:"text--3 text-amber-13"},[t._v(t._s(t.haveparent))]):t._e(),t.havechildren.length?e("div",{staticClass:"text--3 text-orange-13"},t._l(t.havechildren,(function(s,a){return e("span",{key:a},[t._v(t._s(s.id)+" ")])})),0):t._e()])])]),e("q-btn",{attrs:{flat:"",icon:"menu"},on:{click:function(e){t.ldrawer.state=!0}}})],1),e("div",{staticClass:"row items-center justify-between q-mt-sm"},[e("div",{staticClass:"row text-center items-end"},[e("div",{staticClass:"q-px-md"},[e("div",{staticClass:"text--2"},[t._v("Modelos")]),e("span",{staticClass:"text-green-13 text-bold"},[t._v(t._s(t.dbproducts.length))])]),e("div",{staticClass:"q-px-md"},[e("div",{staticClass:"text--2"},[t._v("Piezas")]),e("span",{staticClass:"text-green-13 text-bold"},[t._v(t._s(t.totalPzsProds))])])]),e("div",{staticClass:"col text-right q-px-sm"},[e("div",{staticClass:"text--2"},[t._v("Total")]),e("div",{staticClass:"text-green-13 text-h6 text-bold"},[t._v("$ "+t._s(t.totalCashProds))])])])]),e("q-drawer",{attrs:{side:"right","content-class":"bg-darkl0"},on:{hide:function(e){t.startremove.state=!1}},model:{value:t.ldrawer.state,callback:function(e){t.$set(t.ldrawer,"state",e)},expression:"ldrawer.state"}},[e("div",{staticClass:"q-pa-md"},[t.currentStep&&1==t.currentStep.id?[e("div",{staticClass:"text-overline"},[t._v("Unidad de surtido")]),e("q-select",{attrs:{borderless:"",dense:"",dark:"",color:"green-13","option-value":"id","option-label":"name",options:t.metsupplies},model:{value:t.metdeftsupply,callback:function(e){t.metdeftsupply=e},expression:"metdeftsupply"}}),e("q-separator")]:t._e(),e("div",{staticClass:"text-overline"},[t._v("Opciones")]),e("div",[e("q-btn-group",{staticClass:"bg-darkl1",attrs:{spread:""}},[t.currentStep&&t.currentStep.id>1?e("q-btn",{attrs:{dark:"",icon:"print"}},[e("q-menu",{attrs:{"content-class":"bg-darkl1"}},[e("PrinterSelect",{attrs:{"label-title":"Reimprimir"},on:{input:t.reprint}})],1)],1):t._e(),t.gBasket.length?[e("q-btn",{attrs:{dark:"",icon:"fas fa-file-excel"},on:{click:t.orderExport}})]:t._e(),t.currentStep&&1==t.currentStep.id?[e("q-btn",{attrs:{dark:"",icon:"fas fa-file-upload"}}),t.startremove.state?e("div",[e("div",{staticClass:"q-ma-sm"},[t._v("Archivar?")]),e("span",{staticClass:"col row q-gutter-md"},[e("q-btn",{staticClass:"col",attrs:{label:"Si",color:"negative"},on:{click:t.archive}}),e("q-btn",{staticClass:"col",attrs:{flat:"",label:"No",color:"amber-13"},on:{click:function(e){t.startremove.state=!1}}})],1)]):e("q-btn",{attrs:{icon:"delete",color:"negative"},on:{click:function(e){t.startremove.state=!0}}})]:t._e(),!t.currentStep||3!=t.currentStep.id&&4!=t.currentStep.id?t._e():[e("q-btn",{attrs:{icon:"fas fa-pencil-alt",color:"orange-14"}})],t.currentStep&&5==t.currentStep.id?[t.startanx.state?e("div",[e("div",{staticClass:"q-ma-sm"},[t._v("Crear Anexo?")]),e("span",{staticClass:"col row q-gutter-md"},[e("q-btn",{staticClass:"col",attrs:{"no-caps":"",label:"Si",color:"primary"},on:{click:t.createanx}}),e("q-btn",{staticClass:"col",attrs:{flat:"","no-caps":"",label:"No",color:"amber-13"},on:{click:function(e){t.startanx.state=!1}}})],1)]):e("q-btn",{attrs:{icon:"fas fa-file-medical",color:"primary"},on:{click:function(e){t.startanx.state=!0}}})]:t._e()],2)],1)],2),e("div",{staticClass:"q-pt-md q-pl-md"},[e("q-timeline",{attrs:{color:"green-13",dark:""}},t._l(t.orderlog,(function(s){return e("q-timeline-entry",{key:s.id,attrs:{side:"right"},scopedSlots:t._u([{key:"subtitle",fn:function(){return[t._v(t._s(s.name))]},proxy:!0}],null,!0)},[e("div",{staticClass:"text--2"},[t._v(t._s(t.humantime(s.created_at)))]),e("div",[t._v(t._s(s.responsable.nick?s.responsable.nick:"VizApp"))])])})),1)],1)]),t.artduplicate.state?e("div",{staticClass:"q-pa-md q-mt-md"},[e("q-banner",{staticClass:"bg-amber-13 text-dark",attrs:{"inline-actions":"",squared:"",rounded:""},scopedSlots:t._u([{key:"avatar",fn:function(){return[e("q-img",{staticClass:"dinobebe",attrs:{src:s("e7de"),width:"90px"}})]},proxy:!0},{key:"action",fn:function(){return[e("q-btn",{staticClass:"text-bold text-amber-12",attrs:{color:"dark","no-caps":"",label:"Ok"},on:{click:function(e){t.artduplicate.state=!1,t.artduplicate.state=void 0,t.$refs.patc.putFocus()}}})]},proxy:!0}],null,!1,1762560673)},[t._v("\n\n                Esto ya esta en la lista\n\n                ")]),e("transition",{attrs:{appear:"","enter-active-class":"animated bounceInUp","leave-active-class":"animated zoomOut"}},[e("div",{staticClass:"q-py-lg q-px-sm wrapper_prod",on:{click:function(e){return t.edit(t.artduplicate.product)}}},[e("div",{staticClass:"row items-center"},[e("div",{staticClass:"q-pr-sm"},[e("q-img",{attrs:{src:s("d3b1"),width:"50px"}})],1),e("div",{staticClass:"col q-pr-sm"},[e("div",[e("span",[t._v(t._s(t.artduplicate.product.code))]),t._v(" --\n                                "),e("span",[t._v(t._s(t.artduplicate.product.name))])]),e("div",{staticClass:"text--2 text-grey-5"},[t._v(t._s(t.artduplicate.product.description))]),e("div",{staticClass:"col text--2"},[t._v(t._s(t.artduplicate.product.metsupply.name)+" "+t._s(t.artduplicate.product.ordered.amount)+t._s(1!=t.artduplicate.product.metsupply.id?` (${t.artduplicate.product.units} pzs)`:"")+", PU: $"+t._s(t.artduplicate.product.usedprice.price))]),e("div",{staticClass:"text--2 text-amber-13"},[t._v(t._s(t.artduplicate.product.ordered.comments))])]),e("div",{staticClass:"text-right text-green-13"},[t._v("$ "+t._s(t.artduplicate.product.total))])])])])],1):t._e(),t.artduplicate.state?t._e():e("div",{staticClass:"q-mb-xl"},[e("q-list",{attrs:{dark:""}},[t.basketPzs.length?e("q-expansion-item",{attrs:{"expand-separator":"","default-opened":"","header-class":"text-white","expand-icon-class":"hidden"},scopedSlots:t._u([{key:"header",fn:function(){return[e("div",{staticClass:"row full-width items-center justify-between q-py-md hei"},[e("div",[t._v("Piezas: "+t._s(t.basketPzs.length)+" productos "),e("q-icon",{attrs:{name:"fas fa-caret-right"}}),t._v(" "+t._s(t.pzsPzsBasket)+" pzs")],1),e("div",{staticClass:"text-bold"},[t._v("$ "+t._s(t.totalCashPzs))])])]},proxy:!0}],null,!1,2924286908)},[e("transition-group",{attrs:{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"}},t._l(t.basketPzs,(function(a){return e("div",{key:a.id,staticClass:"q-py-md q-px-sm wrapper_prod",on:{click:function(e){return t.edit(a)}}},[e("div",{staticClass:"row items-center"},[e("div",{staticClass:"q-pr-sm"},[e("q-img",{attrs:{src:s("d3b1"),width:"50px"}})],1),e("div",{staticClass:"col q-pr-sm"},[e("div",[e("span",[t._v(t._s(a.code))]),t._v(" --\n                                        "),e("span",[t._v(t._s(a.name))])]),e("div",{staticClass:"text--3 text-uppercase text-italic"},[t._v(t._s(a.family)+" (pxc "+t._s(a.ipack)+")")]),e("div",{staticClass:"text--2 text-grey-5"},[t._v(t._s(a.description))]),e("div",{staticClass:"col text--2"},[t._v(t._s(a.metsupply.name)+" "+t._s(a.ordered.amount)+t._s(1!=a.metsupply.id?` (${a.units} pzs)`:"")+", PU: $"+t._s(a.usedprice.price))]),e("div",{staticClass:"text--2 text-amber-13"},[t._v(t._s(a.ordered.comments))])]),e("div",{staticClass:"text-right"},[e("div",[t._v("$ "+t._s(a.total))]),e("div",{staticClass:"text--3 text-center text-uppercase"},[t._v(t._s("off"==a.productType?"OFERTA":a.usedprice.name))])])])])})),0)],1):t._e(),t.basketBxs.length?e("q-expansion-item",{attrs:{"expand-separator":"","default-opened":"","header-class":"text-white","expand-icon-class":"hidden"},scopedSlots:t._u([{key:"header",fn:function(){return[e("div",{staticClass:"row full-width items-center justify-between q-py-md hei"},[e("div",[t._v("Cajas: "+t._s(t.basketBxs.length)+" productos "),e("q-icon",{attrs:{name:"fas fa-caret-right"}}),t._v(" "+t._s(t.pzsBxsBasket)+" pzs")],1),e("div",{staticClass:"text-bold"},[t._v("$ "+t._s(t.totalCashBxs))])])]},proxy:!0}],null,!1,3464692898)},[e("transition-group",{attrs:{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"}},t._l(t.basketBxs,(function(a){return e("div",{key:a.id,staticClass:"q-py-md q-px-sm wrapper_prod",on:{click:function(e){return t.edit(a)}}},[e("div",{staticClass:"row items-center"},[e("div",{staticClass:"q-pr-sm"},[e("q-img",{attrs:{src:s("d3b1"),width:"50px"}})],1),e("div",{staticClass:"col q-pr-sm"},[e("div",[e("span",[t._v(t._s(a.code))]),t._v(" --\n                                        "),e("span",[t._v(t._s(a.name))])]),e("div",{staticClass:"text--3 text-uppercase text-italic"},[t._v(t._s(a.family)+" (pxc "+t._s(a.ipack)+")")]),e("div",{staticClass:"text--2 text-grey-5"},[t._v(t._s(a.description))]),e("div",{staticClass:"col text--2"},[t._v(t._s(a.metsupply.name)+" "+t._s(a.ordered.amount)+t._s(1!=a.metsupply.id?` (${a.units} pzs)`:"")+", PU: $"+t._s(a.usedprice.price))]),e("div",{staticClass:"text--2 text-amber-13"},[t._v(t._s(a.ordered.comments))])]),e("div",{staticClass:"text-right"},[e("div",[t._v("$ "+t._s(a.total))]),e("div",{staticClass:"text--3 text-uppercase"},[t._v(t._s("off"==a.productType?"OFERTA":a.usedprice.name))])])])])})),0)],1):t._e(),t.basketDcs.length?e("q-expansion-item",{attrs:{"expand-separator":"","switch-toggle-side":"","default-opened":"","header-class":"text-white","expand-icon-class":"hidden"},scopedSlots:t._u([{key:"header",fn:function(){return[e("div",{staticClass:"row full-width items-center justify-between q-py-md hei"},[e("div",[t._v("Docenas: "+t._s(t.basketDcs.length))]),e("div",{staticClass:"text-bold"},[t._v("$ "+t._s(t.totalCashDcs))])])]},proxy:!0}],null,!1,3906237469)},[e("transition-group",{attrs:{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"}},t._l(t.basketDcs,(function(a){return e("div",{key:a.id,staticClass:"q-py-md q-px-sm wrapper_prod",on:{click:function(e){return t.edit(a)}}},[e("div",{staticClass:"row items-center"},[e("div",{staticClass:"q-pr-sm"},[e("q-img",{attrs:{src:s("d3b1"),width:"50px"}})],1),e("div",{staticClass:"col q-pr-sm"},[e("div",[e("span",[t._v(t._s(a.code))]),t._v(" --\n                                        "),e("span",[t._v(t._s(a.name))])]),e("div",{staticClass:"text--2 text-grey-5"},[t._v(t._s(a.description))]),e("div",{staticClass:"col text--2"},[t._v(t._s(a.metsupply.name)+" "+t._s(a.ordered.amount)+t._s(1!=a.metsupply.id?` (${a.units} pzs)`:"")+", PU: $"+t._s(a.usedprice.price))]),e("div",{staticClass:"text--2 text-amber-13"},[t._v(t._s(a.ordered.comments))])]),e("div",{staticClass:"text-right"},[t._v("$ "+t._s(a.total))])])])})),0)],1):t._e()],1)],1),e("q-dialog",{attrs:{position:"bottom"},model:{value:t.wndAdder.state,callback:function(e){t.$set(t.wndAdder,"state",e)},expression:"wndAdder.state"}},[e("q-card",{staticClass:"text-white bg-darkl1 exo"},[e("q-card-section",{staticClass:"bg-darkl2 text-white text-overline"},[t._v("AGREGAR PRODUCTO")]),t.wndAdder.product?[e("ProductAOE",{ref:"paoe_adder",attrs:{showprices:"",product:t.wndAdder.product,client:t.index.client,deftunitsupply:t.metdeftsupply.id},on:{confirm:t.productAdd,cancel:t.cancelAOE}})]:t._e()],2)],1),e("q-dialog",{staticClass:"exo",attrs:{position:"bottom"},on:{hide:t.cleanEditor},model:{value:t.wndEditor.state,callback:function(e){t.$set(t.wndEditor,"state",e)},expression:"wndEditor.state"}},[t.wndEditor.product?[e("q-card",{staticClass:"bg-darkl1 text-white exo"},[e("q-card-section",{staticClass:"bg-darkl2 text-white text-overline"},[t._v("EDITAR PRODUCTO")]),e("q-separator"),e("ProductAOE",{ref:"paoe_editor",attrs:{showprices:"",product:t.wndEditor.product,client:t.index.client},on:{confirm:t.productEdit,cancel:t.cancelAOE,remove:t.remove}})],1)]:t._e()],2),e("q-dialog",{attrs:{position:"bottom"},model:{value:t.wndPrinters.state,callback:function(e){t.$set(t.wndPrinters,"state",e)},expression:"wndPrinters.state"}},[e("q-card",{staticClass:"bg-darkl1 text-white exo",attrs:{flat:""}},[e("q-card-section",{staticClass:"text-overline bg-blue-grey-9"},[t._v("Seleccione Impresora")]),e("PrinterSelect",{on:{input:t.nextStep}})],1)],1),e("q-dialog",{attrs:{position:"bottom"},model:{value:t.wndExport.state,callback:function(e){t.$set(t.wndExport,"state",e)},expression:"wndExport.state"}},[e("q-card",{staticClass:"exo bg-darkl0 text-white"},[e("q-card-section",{staticClass:"bg-darkl2 text-white text-overline"},[t._v("EXPORTAR PEDIDO")])],1)],1),e("q-footer",{staticClass:"bg-darkl1 text-white"},[t.currentStep&&1==t.currentStep.id?e("div",{staticClass:"q-pa-xs row items-center"},[e("div",{staticClass:"col text-center"},[e("ProductAutocomplete",{ref:"patc",attrs:{with_image:"",with_prices:"",with_stock:""},on:{input:t.setProduct,similarcodes:t.similarCodes}})],1),e("div",{staticClass:"text-right"},[t.gBasket.length?e("q-btn",{attrs:{icon:"fas fa-arrow-right",color:"green-13",flat:""},on:{click:function(e){return t.initPrinters("print")}}}):t._e()],1)]):t._e(),t.wndAdder.similars.length?e("q-card",{staticClass:"bg-darkl1 q-pa-sm"},[e("div",[t._v("Varios productos coinciden con tu lectura")]),e("div",{staticClass:"row wrapper_similars q-pa-md"},t._l(t.wndAdder.similars,(function(s){return e("div",{key:s.id,staticClass:"col-6 q-pa-xs"},[e("q-card",{staticClass:"q-pa-sm bg-darkl2",on:{click:function(e){return t.setProduct(s)}}},[e("div",[t._v(t._s(s.code)+" -- "+t._s(s.name))]),e("div",{staticClass:"text--3"},[t._v(t._s(s.description))]),e("div",{staticClass:"text--3",class:1==s.status.id?"text-green-13":"text-amber-13"},[t._v(t._s(s.status.name))])])],1)})),0),e("q-card-actions",[e("q-btn",{staticClass:"full-width",attrs:{flat:"",icon:"close"},on:{click:function(e){t.wndAdder.similars=[],t.$refs.patc.putFocus()}}})],1)],1):t._e()],1)],1)},i=[],r=(s("ddb0"),s("bd4c")),o=s("5542"),d=s("b293"),n=s("4709"),c=s("e8ae"),l=s.n(c),p=s("21a6"),u=s.n(p),m=s("3a84"),h={components:{ProductAutocomplete:d["a"],PrinterSelect:m["a"],ProductAOE:n["a"]},data(){return{psocket:this.$sktPreventa,art_filtrator:"",index:void 0,moreopts:!1,artduplicate:{state:!1,product:void 0},wndAdder:{state:!1,product:void 0,similars:[]},wndEditor:{state:!1,product:void 0},wndPrinters:{state:!1,printer:null,job:"print"},ldrawer:{state:!1},startremove:{state:!1},startanx:{state:!1},tableproducts:{columns:[{name:"id",align:"left",label:"ID",field:"id",sortable:!0},{name:"code",align:"left",label:"Codigo",field:"code",sortable:!0},{name:"name",align:"center",label:"Codigo Corto",field:"name",sortable:!1},{name:"description",align:"center",label:"Description",field:"description",sortable:!1},{name:"cant",align:"center",label:"Cantidad",field:"cant",sortable:!0},{name:"pieces",align:"center",label:"PzsXCaj",field:"pieces",sortable:!0},{name:"ppp",align:"center",label:"PPP",field:"ppp",sortable:!0},{name:"uprice",align:"center",label:"Precio Unitario",field:"uprice",sortable:!0},{name:"total",align:"center",label:"Total",field:"total",sortable:!0}],filtrator:"",pagination:{descending:!1,page:1,rowsPerPage:10}},pricelists:[{id:1,alias:"MEN",name:"MENUDEO"},{id:2,alias:"MAY",name:"MAYOREO"},{id:3,alias:"DOC",name:"DOCENA"},{id:4,alias:"CAJ",name:"CAJA"}],metdeftsupply:{name:"Piezas",id:1,alias:"PZS"},metsupplies:[{name:"Piezas",id:1,alias:"PZS"},{name:"Docenas",id:2,alias:"DOC"},{name:"Cajas",id:3,alias:"CJS"}],wndExport:{state:!1}}},async mounted(){this.$store.commit("Preventa/setHeaderState",!1),this.$store.commit("Preventa/setFooterState",!1),this.$q.loading.show({message:"..."}),this.index=await o["a"].order(this.ordercatch),console.log("%cPedido Cargado...","font-size:2em;color:#1e90ff;text-shadow:1px 1px 4px #ff6b81;"),console.log(this.index),this.$q.loading.hide()},destroyed(){this.$store.commit("Preventa/setHeaderState",!0),this.$store.commit("Preventa/setFooterState",!0)},methods:{similarCodes(t){this.wndAdder.similars=t},setProduct(t){if(1==this.currentStep.id){let e=this.index.products.find((e=>e.code==t.code));e?(this.artduplicate.state=!0,this.artduplicate.product=e):(this.wndAdder.product=t,this.wndAdder.state=!0)}},orderExport(){this.$q.loading.show({message:"Generando..."}),console.log("Exportando pedido!!");let t=`Peventa_${this.workin.workpoint.alias}_${this.index.id}.xlsx`;const e=new l.a.Workbook;let s=e.addWorksheet("Sheet One");s.columns=[{header:"id",key:"id",width:10},{header:"Codigo",key:"code",width:15},{header:"Codigo corto",key:"scode",width:20},{header:"Descripcion",key:"dsc",width:40},{header:"Seccion",key:"sec",width:20},{header:"Familia",key:"fam",width:20},{header:"Categoria",key:"cat",width:20},{header:"Cantidad",key:"amount",width:10},{header:"Unidad de surtido",key:"usup",width:20},{header:"Piezas",key:"pzs",width:10},{header:"Lista de Precio",key:"plist",width:15},{header:"Precio / Unidad",key:"price",width:15},{header:"Total",key:"total",width:15}],console.log(this.gBasket),this.gBasket.forEach((t=>{s.addRow({id:t.id,code:t.code,scode:t.name,dsc:t.description,sec:t.section,fam:t.family,cat:t.category,ipack:t.pieces,amount:t.ordered.amount,usup:t.metsupply.name,pzs:t.units,plist:t.usedprice.name,price:t.usedprice.price,total:t.total})})),e.xlsx.writeBuffer("exported.xlsx").then((e=>{const s=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"});u()(s,t),this.$q.notify({icon:"done",color:"positive",message:"Documento guardado en Descargas"})})),this.$q.loading.hide()},edit(t){1==this.currentStep.id&&(this.wndEditor.product=t,this.wndEditor.state=!0)},cleanEditor(){this.wndEditor.product=void 0,this.$refs.patc.putFocus()},async archive(){let t={_order:this.ordercatch.id},e=await o["a"].archive(t);if(e.err)this.$q.notify({message:e.err,color:"negative",icon:"fas fa-exclamation-triangle"});else{let t=e.status[e.status.length-1],s=Object.assign({},this.index);this.psocket.emit("order_update",{newstate:t,order:s}),this.$q.notify({message:"Archivado correcto!!",color:"positive",icon:"done"}),this.$router.push("/preventa/pedidos")}},async productAdd(t){this.$q.loading.show({message:`Agregando ${t.product.code}...`});let e={_product:t.product.id,_order:this.ordercatch.id,_supply_by:t.metsupply.id,amount:t.amount,comments:t.comments},s=await o["a"].add(e);s.err?console.log(s.err):(this.index.products.unshift(s),this.appsounds.added.play(),this.wndAdder.product=void 0,this.wndAdder.similars=[],this.wndAdder.state=!1,this.$refs.patc.putFocus()),this.$q.loading.hide()},async productEdit(t){this.$q.loading.show({message:`Guardando ${t.product.code}...`});let e=this.wndEditor.product,s={_product:t.product.id,_order:this.ordercatch.id,_supply_by:t.metsupply.id,amount:t.amount,comments:t.comments};console.log(s);let a=await o["a"].add(s);a.error?(console.log(a.error),this.$q.notify({message:"No se pudo actualizar el producto",icon:"close",color:"negative"})):(e.ordered.amount=t.amount,e.ordered.comments=t.comments,e.ordered._supply_by=t.metsupply.id,this.$q.notify({message:"Producto Actualizado!!",position:"center",color:"positive",icon:"done",timeout:1200}),this.wndEditor.state=!1,this.wndEditor.product=void 0,this.$refs.patc.putFocus()),this.$q.loading.hide()},async remove(t){this.$q.loading.show({message:`Quitando ${t.product.code}...`});let e={_product:t.product.id,_order:this.ordercatch.id},s=await o["a"].removeProduct(e);if(s.err)this.$q.notify({message:s.err,icon:"fas fa-exclamation-triangle",color:"negative"});else{let e=this.index.products.findIndex((e=>e.id==t.product.id));this.index.products.splice(e,1),this.$q.notify({message:`${t.product.code} eliminado!`,icon:"done",color:"positive",timeout:1e3,position:"center"}),this.wndEditor.product=void 0,this.wndEditor.state=!1}this.$q.loading.hide()},initPrinters(){this.wndPrinters.state=!0},print(t){this.wndPrinters.printer=t,"print"==this.wndPrinters.job?this.nextStep():this.reprint()},async reprint(t){this.$q.loading.show({message:"Reimprimiendo..."});let e={_order:this.ordercatch.id,_printer:t.id},s=await o["a"].rePrint(e);s.err?this.$q.notify({message:"Error de impresion :(",color:"negative",icon:"fas fa-bug",timeout:1500,position:"center"}):this.$q.notify({message:"Reimpresion correcta",color:"positive",icon:"done"}),this.$q.loading.hide()},async nextStep(t){this.$q.loading.show({message:"Enviando..."});let e={_order:this.ordercatch.id,_printer:t.id},s=await o["a"].nextStep(e);if(s.err)this.$q.notify({message:s.err,color:"negative",icon:"fas fa-exclamation-triangle"});else{this.index.log=this.index.log.concat(s.status);let t=s.status[s.status.length-1],a=Object.assign({},this.index);a.status=t,this.psocket.emit("order_update",{newstate:t,order:a}),this.appsounds.ok.play(),this.$router.push("/preventa/pedidos"),this.$q.notify({message:`Pedido ${e._order} enviado a ${t.name}`,color:"positive",icon:"done",position:"center",timeout:1e3}),this.$q.loading.hide()}},createanx(){this.$q.loading.show({message:"Creando anexo, espera..."});let t={name:this.index.name,_order:this.index.id};console.log(t),o["a"].create(t).then((t=>{let e=t.data;console.log(e),this.$q.notify({message:`Anexo creado con Folio <b>${e.id}</b>`,color:"positive",icon:"done",html:!0}),this.$store.commit("Preventa/newOrder",e),this.psocket.emit("order_add",{user:this.profile,order:e}),this.$router.push(`/preventa/pedidos/${e.id}`),this.$router.go(),this.$q.loading.hide()})).catch((t=>{console.log(t),this.$q.notify({icon:"bug",message:t,color:"negative"})}))},cancelAOE(){this.wndAdder.product=void 0,this.wndAdder.state=!1,this.wndAdder.similars=[],this.wndEditor.product=void 0,this.wndEditor.state=!1,this.$refs.patc.putFocus()}},computed:{profile(){return this.$store.getters["Account/profile"]},workin(){return this.$store.getters["Account/workin"]},printers(){return this.$store.getters["Preventa/printersSale"]},ordercatch(){return this.$route.params},client(){return this.index?this.index._client?{type:"REG",name:"Peter Parker",id:115}:{type:"STD",name:this.index.name}:{type:"STD"}},pfams(){return this.index?this.index.products.map((t=>t.family)):[]},upfams(){return[...new Set(this.pfams)]},dbproducts(){return this.index?this.index.products.map((t=>(t.ipack=t.pieces?t.pieces:1,t.pricelistDefault=this.pricelists.find((t=>t.id==this.index.client._price_list)),t.metsupply=(t=>this.metsupplies.find((e=>e.id==t.ordered._supply_by)))(t),t.productType=(t=>{if(t.prices.length){let e=t.prices[0].price,s=t.prices.filter((t=>t.id<=4)).filter((t=>e==t.price)).length==t.prices.length;return s?"off":"std"}return{error:!0,msg:"Producto sin precios"}})(t),t.units=(t=>{switch(t.ordered._supply_by){case 2:return 12*t.ordered.amount;case 3:return t.ordered.amount*t.ipack;default:return t.ordered.amount}})(t),t.boxes=(t=>(t.units/t.ipack).toFixed(1))(t),t.usedprice=(t=>{let e=this.index.products.filter((e=>e.family==t.family&&e.code!=t.code)),s=0;switch(s=e.length?e.reduce(((t,e)=>{switch(e.ordered._supply_by){case 2:return 12*e.ordered.amount+t;case 3:return e.ordered.amount*e.pieces+t;default:return e.ordered.amount+t}}),t.units):t.units,t.ordered._supply_by){case 2:return t.prices.find((t=>3==t.id));case 3:return t.prices.find((t=>4==t.id));default:if("off"==t.productType||s<3)return t.prices.find((t=>1==t.id));if(s>=3&&t.ordered.amount<t.ipack)return t.prices.find((t=>2==t.id));if(t.ordered.amount>=t.ipack)return t.prices.find((t=>4==t.id));break}})(t),t.total=t.units*t.usedprice.price,t))):[]},totalPzsProds(){return this.dbproducts.reduce(((t,e)=>parseInt(e.units)+t),0)},totalCashProds(){return this.dbproducts.reduce(((t,e)=>e.total+t),0)},gBasket(){if(this.art_filtrator.length){let t=this.art_filtrator.toUpperCase().trim(),e=this.dbproducts.filter((e=>e.barcode.match(t)||e.code.match(t)||e.name.match(t)||e.description.match(t)));return e.length?e:[]}return this.dbproducts},basketPzs(){return this.gBasket.length?this.gBasket.filter((t=>1==t.metsupply.id)):[]},totalCashPzs(){return this.basketPzs.reduce(((t,e)=>e.total+t),0)},pzsPzsBasket(){return this.basketPzs.length?this.basketPzs.reduce(((t,e)=>parseInt(e.units)+t),0):0},basketDcs(){return this.gBasket.length?this.gBasket.filter((t=>2==t.metsupply.id)):[]},totalCashDcs(){return this.basketDcs.reduce(((t,e)=>e.total+t),0)},basketBxs(){return this.gBasket.length?this.gBasket.filter((t=>3==t.metsupply.id)):[]},totalCashBxs(){return this.basketBxs.reduce(((t,e)=>e.total+t),0)},pzsBxsBasket(){return this.basketBxs.length?this.basketBxs.reduce(((t,e)=>parseInt(e.units)+t),0):0},currentStep(){return this.index?this.index.status:null},appsounds(){return this.$store.getters["Multimediapp/sounds"]},haveparent(){return!!this.index&&this.index._order},havechildren(){return!!this.index&&this.index.children},orderlog(){return this.index?this.index.log:[]},humantime(){return t=>{let e=Date.now(),s=Date.parse(t),a=r["b"].getDateDiff(e,s,"days");switch(a){case 0:return r["b"].formatDate(s,"hh:mm a");case 1:return"Ayer, "+r["b"].formatDate(s,"hh:mm a");default:return`Hace ${a} dias, `+r["b"].formatDate(s,"hh:mm a")}}}}},v=h,x=(s("a7e1"),s("2877")),_=s("9989"),f=s("e359"),g=s("9c40"),b=s("0016"),w=s("9404"),C=s("ddd8"),k=s("eb85"),y=s("e7a9"),q=s("4e73"),$=s("05eb"),P=s("74af"),E=s("54e1"),A=s("068f"),S=s("1c1c"),z=s("3b73"),D=s("24e8"),B=s("f09f"),O=s("a370"),Q=s("7ff0"),T=s("4b7e"),R=s("eebe"),F=s.n(R),I=Object(x["a"])(v,a,i,!1,null,"7ba03278",null);e["default"]=I.exports;F()(I,"components",{QPage:_["a"],QHeader:f["a"],QBtn:g["a"],QIcon:b["a"],QDrawer:w["a"],QSelect:C["a"],QSeparator:k["a"],QBtnGroup:y["a"],QMenu:q["a"],QTimeline:$["a"],QTimelineEntry:P["a"],QBanner:E["a"],QImg:A["a"],QList:S["a"],QExpansionItem:z["a"],QDialog:D["a"],QCard:B["a"],QCardSection:O["a"],QFooter:Q["a"],QCardActions:T["a"]})},a7e1:function(t,e,s){"use strict";s("ea4d")},ea4d:function(t,e,s){}}]);