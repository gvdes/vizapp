(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"2ce1":function(t,s,e){},"3a18":function(t,s,e){"use strict";e("2ce1")},"42c0":function(t,s,e){"use strict";e.r(s);var a=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("q-page",{attrs:{padding:""}},[e("q-header",{staticClass:"bg-darkl1",attrs:{elevated:""}},[e("div",{staticClass:"row items-center"},[e("div",[e("q-btn",{attrs:{flat:"",icon:"fas fa-chevron-left"},on:{click:function(s){return t.$router.push("/preventa")}}})],1),e("div",{staticClass:"text-right text-white text-white"},[e("div",{staticClass:"q-pa-sm row items-center justify-center text-uppercase",class:"STD"==t.client.type?"bg-dark q-px-md":"bg-blue-grey-7"},["STD"!=t.client.type?e("q-icon",{staticClass:"q-mr-sm",attrs:{name:"fas fa-medal"}}):t._e(),t._v("\n                        "+t._s("STD"==t.client.type?t.client.name:t.client.name+" ("+t.client.id+")")+"\n                    ")],1)]),e("div",{staticClass:"col text-right"},[e("span",{staticClass:"text--2"},[t._v("Folio:")]),e("span",{staticClass:"text-h6 text-bold q-px-sm"},[t._v(t._s(t.ordercatch.id))])])]),e("div",{staticClass:"row items-center q-py-sm"},[e("div",{staticClass:"col"},[e("q-chip",{staticClass:"text--1",attrs:{color:"dark"}},[e("q-avatar",{attrs:{color:"dark","text-color":"white"}},[t._v("M")]),e("span",{staticClass:"text-green-13"},[t._v(t._s(t.basket.length))])],1),e("q-chip",{staticClass:"text--1",attrs:{color:"dark"}},[e("q-avatar",{attrs:{color:"dark","text-color":"white"}},[t._v("P")]),e("span",{staticClass:"text-green-13"},[t._v(t._s(t.totaltkt_pzs))])],1)],1),e("div",{staticClass:"text-right text-green-13 text-h6 q-pr-sm"},[t._v("$ "+t._s(t.totaltkt_pay))])])]),t.basket.length?e("div",{staticClass:"q-mb-xl q-mt-sm"},[e("transition-group",{attrs:{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"}},t._l(t.basket,(function(s){return e("q-card",{key:s.id,staticClass:"bg-darkl1 full-width q-mb-md",on:{click:function(e){return t.selprod(s,"e")}}},[e("div",{staticClass:"text-white text-bold q-pa-sm"},[t._v(t._s(s.code))]),e("div",{staticClass:"full-width row"},[e("div",[e("q-img",{staticClass:"divimg",attrs:{src:"https://image.flaticon.com/icons/png/512/578/578158.png"}})],1),e("div",{staticClass:"col text-grey-4 text--2 q-px-sm column justify-around"},[e("div",{staticClass:"text-grey-5"},[t._v(t._s(s.description))]),e("div",{staticClass:"row justify-between"},[e("span",[t._v("Cantidad:")]),e("span",[t._v(t._s(s.cant))])]),e("div",{staticClass:"row justify-between"},[e("span",[t._v("Piezas X Caja:")]),e("span",[t._v(t._s(s.pieces))])]),e("div",{staticClass:"row justify-between"},[e("span",[t._v("Unidades:")]),e("span",[t._v(t._s(s.ppp))])]),e("div",{staticClass:"row justify-between"},[e("span",[t._v("Precio Unitario:")]),e("span",[t._v("$ "+t._s(s.uprice))])]),e("div",{staticClass:"row justify-between text-bold"},[e("span",[t._v("Total: ")]),e("span",{staticClass:"text-green-13"},[t._v(" $ "+t._s(s.total))])])])])])})),1)],1):t._e(),e("q-dialog",{attrs:{position:"bottom"},on:{hide:t.cleanWndAOE},model:{value:t.wndAOE.state,callback:function(s){t.$set(t.wndAOE,"state",s)},expression:"wndAOE.state"}},[t.wndAOE.product?e("q-card",{staticClass:"exo bg-darkl0 text-grey-4"},[e("q-card-section",[e("div",{staticClass:"row justify-between items-end"},[e("div",{staticClass:"text-h6 text-green-13"},[t._v(t._s(t.wndAOE.product.code))]),t.wndAOE.product.stocks?e("div",[e("q-btn",{staticClass:"text-bold",attrs:{flat:"",dense:"","no-caps":"",color:t.wndAOE.product.stocks[0].stock?"green-13":"amber-13",label:"Stock: "+t.wndAOE.product.stocks[0].stock}})],1):t._e()]),e("div",{staticClass:"text--2"},[t._v(t._s(t.wndAOE.product.description))])]),e("div",["std"==t.wndAOE.params.type?[e("div",{staticClass:"text-center row justify-between q-px-md"},t._l(t.wndAOE.product.prices,(function(s){return e("div",{key:s.id,staticClass:"q-px-md"},[e("div",{staticClass:"text--2"},[t._v(t._s(s.alias))]),e("div",{staticClass:"text-bold"},[t._v("$ "+t._s(s.price))])])})),0)]:t._e(),"off"==t.wndAOE.params.type?[e("div",{staticClass:"text-center text-bold text-orange"},[e("div",[t._v("OFERTA")]),e("div",{staticClass:"text-h4"},[t._v("$ "+t._s(t.wndAOE.product.prices[0].price))])])]:t._e(),e("div",{staticClass:"q-mt-lg row items-end"},[e("div",{staticClass:"text-center"},[e("div",{staticClass:"column"},[e("q-btn",{staticClass:"q-py-xs",attrs:{icon:"fas fa-chevron-up",flat:""},on:{click:t.ctrlPzsUp}}),e("div",{staticClass:"text-center col column q-py-md"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.wndAOE.params.amount,expression:"wndAOE.params.amount"}],staticClass:"text-center exo fieldcant",attrs:{type:"number",min:"1"},domProps:{value:t.wndAOE.params.amount},on:{keyup:t.wAOEcalcs,input:function(s){s.target.composing||t.$set(t.wndAOE.params,"amount",s.target.value)}}})]),e("q-btn",{staticClass:"q-py-xs",attrs:{icon:"fas fa-chevron-down",flat:""},on:{click:t.ctrlPzsDown}})],1)]),e("div",{staticClass:"col"},[e("q-markup-table",{staticClass:"col q-mx-md bg-none text-grey-5",attrs:{dark:"",flat:"",dense:"",square:""}},[e("tbody",[e("tr",[e("td",{attrs:{colspan:"2"}},[e("q-select",{attrs:{label:"Surtir por",borderless:"",dense:"",dark:"",color:"green-13","option-value":"id","option-label":"alias",options:t.metsupply.opts},on:{input:t.wAOEcalcs},model:{value:t.metsupply.model,callback:function(s){t.$set(t.metsupply,"model",s)},expression:"metsupply.model"}})],1)]),e("tr",[e("td",{attrs:{colspan:"2"}},[e("q-input",{attrs:{borderless:"",dense:"",dark:"",flat:"",label:"Notas",color:"green-13"},model:{value:t.wndAOE.params.comments,callback:function(s){t.$set(t.wndAOE.params,"comments",s)},expression:"wndAOE.params.comments"}})],1)]),e("tr",[e("td",[t._v("Piezas X Caja")]),e("td",{attrs:{align:"right"}},[t._v(t._s(t.wndAOE.product.pieces))])]),e("tr",[e("td",[t._v("Cajas")]),e("td",{attrs:{align:"right"}},[t._v(t._s(t.wndAOE.params.boxes))])]),e("tr",[e("td",[t._v("Unidades")]),e("td",{attrs:{align:"right"}},[t._v(t._s(t.wndAOE.params.units))])]),e("tr",[e("td",[t._v("Precio unitario")]),e("td",{attrs:{align:"right"}},[t._v(t._s(t.wndAOE.params.price))])]),e("tr",[e("td",[t._v("Total")]),e("td",{attrs:{align:"right"}},[t._v(t._s(t.wndAOE.params.total))])])])])],1)])],2),e("div",{staticClass:"row"},[e("q-btn",{staticClass:"col q-py-md",attrs:{color:"green-13",icon:"done",label:"a"==t.wndAOE.action?"Agregar":"Aplicar","no-caps":"",flat:"",loading:t.wndAOE.actions.done.save,disable:t.wndAOE.actions.done.dis},on:{click:t.doneAOE}}),"e"==t.wndAOE.action?e("q-btn",{staticClass:"col q-py-md",attrs:{color:"amber-13",icon:"delete",label:"Remover","no-caps":"",flat:"",loading:t.wndAOE.actions.remove.rem,disable:t.wndAOE.actions.remove.dis},on:{click:t.remove}}):t._e(),e("q-btn",{staticClass:"col q-py-md",attrs:{color:"light-blue-14",icon:"close",label:"Cancelar","no-caps":"",flat:""},on:{click:t.cancelAOE}})],1)],1):t._e()],1),e("q-dialog",{attrs:{position:"bottom"},model:{value:t.wndPrinters.state,callback:function(s){t.$set(t.wndPrinters,"state",s)},expression:"wndPrinters.state"}},[e("q-card",{staticClass:"bg-darkl1 exo "},[e("q-card-section",{staticClass:"text-white"},[t._v("Seleccione Impresora")]),e("q-card-section",[e("div",{staticClass:"row text-grey-4 justify-around"},t._l(t.wndPrinters.devices.opts,(function(s){return e("q-btn",{key:s.id,class:s.selected?"bg-primary text-white":"",attrs:{flat:"",stack:"","no-caps":""},on:{click:function(e){return t.selPrinter(s.id)}}},[e("q-icon",{attrs:{name:"print",size:"xl"}}),e("div",{staticClass:"text--2"},[t._v(t._s(s.name))])],1)})),1)]),t.wndPrinters.devices.model?e("div",{staticClass:"text-right"},[e("q-btn",{staticClass:"q-pa-md text-bold full-width",attrs:{color:"green-13",flat:"",label:"enviar",loading:t.wndPrinters.next.loading,disable:t.wndPrinters.next.dis},on:{click:t.nextStep}})],1):t._e()],1)],1),e("q-footer",{staticClass:"bg-darkl1 text-white",attrs:{elevated:""}},[t.currentStep&&1==t.currentStep.id?e("div",{staticClass:"q-pa-xs row items-center"},[e("div",[e("q-btn",{staticClass:"q-px-md",attrs:{flat:"",icon:t.moreopts?"fas fa-chevron-down":"fas fa-chevron-up"},on:{click:function(s){t.moreopts=!t.moreopts}}})],1),e("div",{staticClass:"col text-center"},[e("ProductAutocomplete",{on:{input:t.selprod}})],1),e("div",{staticClass:"col-5 text-right"},[t.basket.length?e("q-btn",{attrs:{icon:"fas fa-arrow-right",color:"green-13",dense:"",flat:""},on:{click:function(s){t.wndPrinters.state=!0}}}):t._e()],1)]):t._e(),t.moreopts?e("div",{staticClass:"q-pa-md text-center"},[e("q-btn",{attrs:{label:"Archivar Pedido",icon:"delete",color:"negative","no-caps":""},on:{click:t.archive}})],1):t._e()])],1)},i=[],n=(e("13d5"),e("5542")),r=e("b293"),o={components:{ProductAutocomplete:r["a"]},data(){return{moreopts:!1,index:void 0,wndAOE:{state:!1,product:void 0,params:{amount:1,units:0,boxes:0,type:"std",prices:[],pricelist:null,price:0,total:0,stock:0,comments:""},actions:{done:{dis:!1,save:!1},cancel:{dis:!1},remove:{dis:!1,rem:!1}},action:"a"},dbproducts:[],metsupply:{model:{alias:"Piezas",id:1},opts:[{alias:"Piezas",id:1},{alias:"Docenas",id:2},{alias:"Cajas",id:3}]},priceLists:{model:{id:1,name:"Menudo",alias:"MEN"},opts:[{id:1,name:"Menudo",alias:"MEN"},{id:2,name:"Mayoreo",alias:"MAY"},{id:3,name:"Docena",alias:"DOC"},{id:4,name:"Caja",alias:"CAJ"}]},wndPrinters:{state:!1,devices:{model:null,opts:[]},next:{loading:!1,dis:!1}}}},async beforeMount(){this.$store.commit("Layout/hideToolbarModule"),this.$q.loading.show({message:"..."}),this.index=await n["a"].order(this.ordercatch),console.log(this.index),this.dbproducts=this.index.products.length?this.index.products:[],this.$q.loading.hide();let t=JSON.parse(localStorage.getItem("printers"));console.log(t),this.wndPrinters.devices.opts=t?t.filter((t=>1==t.id))[0].printers.map((t=>(t.selected=!1,t))):[]},beforeDestroy(){this.$store.commit("Layout/showToolbarModule")},methods:{selprod(t,s="a"){if(1==this.currentStep.id){this.wndAOE.product=t;let e=this.productType();"err"!=e.type?(this.wndAOE.action=s,this.wndAOE.params.type=e.type,this.wndAOE.params.prices=e.prices,"e"==this.wndAOE.action&&(this.wndAOE.params.amount=this.wndAOE.product.ordered.amount,this.metsupply.model=this.metsupply.opts.filter((t=>t.id==this.wndAOE.product.ordered._supply_by))[0],this.wndAOE.params.comments=t.ordered.comments),this.wAOEcalcs(),this.wndAOE.state=!0):this.$q.notify({message:e.msg,color:"negative",icon:"far fa-dizzy",position:"center"})}},async archive(){this.$q.loading.show({message:"Archivando pedido..."});let t={_order:this.ordercatch.id},s=await n["a"].archive(t);console.log(s),s.err?this.$q.notify({message:s.err,color:"negative",icon:"fas fa-exclamation-triangle"}):(this.$q.notify({message:"Archivado correcto!!",color:"positive",icon:"done"}),this.$router.push("/preventa"))},async remove(){let t=this.wndAOE.product;this.$q.loading.show({message:`Removiendo ${t.code}...`});let s={_product:t.id,_order:this.ordercatch.id};console.log(s);let e=await n["a"].removeProduct(s);if(console.log(e),e.err)this.$q.notify({message:e.err,icon:"fas fa-exclamation-triangle",color:"negative"});else{let s=this.dbproducts.findIndex((s=>s.id==t.id));this.dbproducts.splice(s,1),this.$q.notify({message:`${t.code} eliminado!`,icon:"done",color:"positive"}),this.$q.loading.hide(),this.wndAOE.state=!1}},ctrlPzsUp(){this.wndAOE.params.amount++,this.wAOEcalcs()},ctrlPzsDown(){this.wndAOE.params.amount>1&&(this.wndAOE.params.amount--,this.wAOEcalcs())},cleanWndAOE(){this.wndAOE.product=void 0,this.wndAOE.action="a",this.wndAOE.params.amount=1,this.wndAOE.params.units=0,this.wndAOE.params.boxes=0,this.wndAOE.params.type="std",this.wndAOE.params.prices=[],this.wndAOE.params.pricelist=null,this.wndAOE.params.price=0,this.wndAOE.params.total=0,this.wndAOE.params.stock=0,this.wndAOE.params.comments="",this.wndAOE.actions.done.dis=!1,this.wndAOE.actions.done.save=!1,this.wndAOE.actions.cancel.dis=!1,this.metsupply.model={alias:"Piezas",id:1}},wAOEcalcs(){let t=this.wndAOE.params.prices,s=null;switch(this.metsupply.model.id){case 2:s=t.filter((t=>3==t.id))[0],this.wndAOE.params.price=s.price,this.wndAOE.params.units=12*this.wndAOE.params.amount,this.wndAOE.params.boxes=(this.wndAOE.params.units/this.wndAOE.product.pieces).toFixed(1);break;case 3:s=t.filter((t=>4==t.id))[0],this.wndAOE.params.price=s.price,this.wndAOE.params.units=this.wndAOE.params.amount*this.wndAOE.product.pieces,this.wndAOE.params.boxes=this.wndAOE.params.amount;break;default:"off"==this.wndAOE.params.type?s=t[0]:this.wndAOE.params.amount<3?s=t.filter((t=>1==t.id))[0]:this.wndAOE.params.amount>=3&&(s=t.filter((t=>2==t.id))[0]),this.wndAOE.params.price=s.price,this.wndAOE.params.units=this.wndAOE.params.amount,this.wndAOE.params.boxes=Math.floor(this.wndAOE.params.amount/this.wndAOE.product.pieces);break}this.wndAOE.params.total=s.price*this.wndAOE.params.units},productType(t=null){let s=t||this.wndAOE.product,e={type:null,prices:[],msg:null};if("STD"==this.client.type){let t=s.prices;if(t.length&&t.reduce(((t,s)=>t+s.price),0)){let s=t[0].price,a=t.filter((t=>t.id<=4)).filter((t=>s==t.price)).length==t.length;return e.type=a?"off":"std",e.prices=t,e}return e.msg="Vaya!!, este producto no tiene precios aun",e.type="err",e}},async doneAOE(){console.log("Aplicando..."),this.wndAOE.actions.done.dis=!0,this.wndAOE.actions.done.save=!0,this.wndAOE.actions.cancel.dis=!0;let t={_product:this.wndAOE.product.id,_order:this.ordercatch.id,_supply_by:this.metsupply.model.id,amount:this.wndAOE.params.amount,comments:this.wndAOE.params.comments},s=await n["a"].add(t);if(s.err)console.log(s.err);else{if(console.log(s.resp),"a"==this.wndAOE.action)this.dbproducts.unshift(s.resp);else{let t=this.dbproducts.findIndex((t=>t.code==s.resp.code));this.dbproducts[t].ordered=s.resp.ordered}this.wndAOE.state=!1}},cancelAOE(){console.log("cancel AOE"),this.wndAOE.state=!1},async nextStep(t=null){this.wndPrinters.next.loading=!0,this.wndPrinters.next.dis=!0,this.$q.loading.show({message:"Enviando..."});let s={_order:this.ordercatch.id,_printer:this.wndPrinters.devices.model.id},e=await n["a"].nextStep(s);e.err?this.$q.notify({message:e.err,color:"negative",icon:"fas fa-exclamation-triangle"}):(this.$router.push("/preventa/pedidos"),this.$q.loading.hide(),this.$q.notify({message:"Enviado!",color:"positive",icon:"done"}))},selPrinter(t){this.wndPrinters.devices.opts.forEach((s=>{s.id==t?(console.log("aca esta la chida",s.name),s.selected=!0,this.wndPrinters.devices.model=s):s.selected=!1}))}},computed:{ordercatch(){return this.$route.params},client(){return this.index?this.index._client?{type:"REG",name:"Peter Parker",id:115}:{type:"STD",name:this.index.name}:{type:"STD"}},basket(){return this.dbproducts.map((t=>{let s=this.metsupply.opts.filter((s=>s.id==t.ordered._supply_by))[0];return t.cant=t.ordered.amount+" "+s.alias,t.type=this.productType(t).type,t.uprice=t.ordered.price,t.ppp=t.ordered.units,t.total=t.ordered.units*t.ordered.price,t}))},totaltkt_pay(){return this.basket.reduce(((t,s)=>t+s.total),0)},totaltkt_pzs(){return this.basket.reduce(((t,s)=>t+s.ppp),0)},currentStep(){return this.index?this.index.status:null}}},d=o,c=(e("3a18"),e("2877")),l=e("9989"),p=e("e359"),m=e("9c40"),u=e("0016"),h=e("b047"),w=e("cb32"),v=e("eaac"),A=e("f09f"),g=e("068f"),E=e("24e8"),O=e("a370"),f=e("2bb1"),b=e("ddd8"),x=e("27f9"),_=e("7ff0"),y=e("eebe"),C=e.n(y),q=Object(c["a"])(d,a,i,!1,null,"14175712",null);s["default"]=q.exports;C()(q,"components",{QPage:l["a"],QHeader:p["a"],QBtn:m["a"],QIcon:u["a"],QChip:h["a"],QAvatar:w["a"],QTable:v["a"],QCard:A["a"],QImg:g["a"],QDialog:E["a"],QCardSection:O["a"],QMarkupTable:f["a"],QSelect:b["a"],QInput:x["a"],QFooter:_["a"]})}}]);