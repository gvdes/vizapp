(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[16],{"28d9":function(t,e,s){},"54fa":function(t,e,s){"use strict";s("28d9")},fc40:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",{class:t.ismobile?"":"q-pb-md overflow-hidden",style:t.ismobile?"":"max-width:100%;max-height:70vh;"},[s("q-header",{staticClass:"bg-darktransl0 text-grey-5 q-pa-sm"},[s("q-card",{staticClass:"bg-darkl1"},[s("toolbar-account",{attrs:{title:"Tablero de Pedidos",sockstate:t.appconnected}})],1)],1),t.ismobile?s("div",{staticClass:"q-px-sm"},[s("q-table",{attrs:{grid:"",dark:"",data:t.ordersdb,"row-key":"id",pagination:t.initpagination},scopedSlots:t._u([{key:"item",fn:function(e){return[s("div",{staticClass:"q-pa-xs col-xs-12 col-sm-6 col-md-4 text-grey-5"},[s("q-card",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"bg-darkl1",attrs:{clickable:""},on:{click:function(s){return t.showLog(e.row.id)}}},[s("q-card-section",[s("div",{staticClass:"row items-center"},[s("div",{staticClass:"col"},[s("div",{staticClass:"text-h4 text-white"},[t._v(t._s(e.row.id))]),s("div",{staticClass:"text-h6 text-light-blue"},[t._v(t._s(e.row.from.alias))]),s("div",{staticClass:"text-amber-13"},[t._v(t._s(e.row.notes))]),s("div",{staticClass:"q-pt-md text--2 text-uppercase text-grey-4"},[t._v(t._s(e.row.status.name))])]),s("div",{staticClass:"text-center self-end"},[s("div",[s("q-avatar",{attrs:{size:"70px"}},[s("img",{attrs:{src:t.buildlog(e.row,"avatar")}})])],1),s("div",[t._v(t._s(t.buildlog(e.row,"resp")))]),s("div",[s("span",{staticClass:"text-white text-bold"},[t._v(t._s(t.buildlog(e.row,"time")))])])])])])],1)],1)]}},{key:"bottom",fn:function(){},proxy:!0}],null,!1,3605897789)})],1):s("div",{staticClass:"row justify-between"},[s("div",{staticClass:"col q-px-sm"},[s("q-card",{staticClass:"bg-none"},[s("q-toolbar",{staticClass:"q-mb-sm text-green-13 bg-darkl1 text-uppercase text-thin text-h5"},[t._v("\n                        Levantando"),s("q-space"),t._v(t._s(t.orderTaking.length)+"\n                    ")],1)],1),s("q-scroll-area",{staticStyle:{height:"75vh","max-width":"100%"}},[s("transition-group",{attrs:{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"}},t._l(t.orderTaking,(function(e){return s("q-card",{directives:[{name:"ripple",rawName:"v-ripple"}],key:e.id,staticClass:"bg-darkl1 q-mb-sm",attrs:{clickable:""},on:{click:function(s){return t.showLog(e.id)}}},[s("q-card-section",[s("div",{staticClass:"row items-center"},[s("div",{staticClass:"col"},[s("div",{staticClass:"text-h4 text-white"},[t._v(t._s(e.id))]),s("div",{staticClass:"text-h6 text-light-blue"},[t._v(t._s(e.from.alias))]),s("div",{staticClass:"text-amber-13"},[t._v(t._s(e.notes))])]),s("div",{staticClass:"text-center self-end"},[s("div",[s("q-avatar",{attrs:{size:"70px"}},[s("img",{attrs:{src:t.buildlog(e,"avatar")}})])],1),s("div",[t._v(t._s(t.buildlog(e,"resp")))]),s("div",[s("span",{staticClass:"text-white text-bold"},[t._v(t._s(t.buildlog(e,"time")))])])])])])],1)})),1)],1)],1),s("div",{staticClass:"col q-px-sm"},[s("q-card",{staticClass:"bg-darkl0"},[s("q-toolbar",{staticClass:"q-mb-sm text-green-13 bg-darkl1 text-uppercase text-thin text-h5"},[t._v("\n                        Por surtir"),s("q-space"),t._v(t._s(t.orderForSupply.length)+"\n                    ")],1)],1),s("q-scroll-area",{staticStyle:{height:"75vh","max-width":"100%"}},[s("transition-group",{attrs:{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"}},t._l(t.orderForSupply,(function(e){return s("q-card",{directives:[{name:"ripple",rawName:"v-ripple"}],key:e.id,staticClass:"bg-darkl1 q-mb-sm",attrs:{clickable:""},on:{click:function(s){return t.showLog(e.id)}}},[0==e.printed?s("q-banner",{staticClass:"text-white bg-red",attrs:{dense:""},scopedSlots:t._u([{key:"avatar",fn:function(){return[s("q-icon",{attrs:{name:"fas fa-exclamation-triangle",color:"white"}})]},proxy:!0}],null,!0)},[s("span",{staticClass:"text--1"},[t._v("Rayos!!, este pedido no logro imprimirse :(")])]):t._e(),s("q-card-section",[s("div",{staticClass:"row items-center"},[s("div",{staticClass:"col"},[s("div",{staticClass:"text-h4 text-white"},[t._v(t._s(e.id))]),s("div",{staticClass:"text-h6 text-light-blue"},[t._v(t._s(e.from.alias))]),s("div",{staticClass:"text-amber-13"},[t._v(t._s(e.notes))])]),s("div",{staticClass:"text-center self-end"},[s("div",[s("q-avatar",{attrs:{size:"70px"}},[s("img",{attrs:{src:t.buildlog(e,"avatar")}})])],1),s("div",[t._v(t._s(t.buildlog(e,"resp")))]),s("div",[s("span",{staticClass:"text-white text-bold"},[t._v(t._s(t.buildlog(e,"time")))])])])])])],1)})),1)],1)],1),s("div",{staticClass:"col q-px-sm"},[s("q-card",{staticClass:"bg-darkl0"},[s("q-toolbar",{staticClass:"q-mb-sm text-green-13 bg-darkl1 text-uppercase text-thin text-h5"},[t._v("\n                        Surtiendo"),s("q-space"),t._v(t._s(t.orderSuppling.length)+"\n                    ")],1)],1),s("q-scroll-area",{staticStyle:{height:"75vh","max-width":"100%"}},[s("transition-group",{attrs:{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"}},t._l(t.orderSuppling,(function(e){return s("q-card",{directives:[{name:"ripple",rawName:"v-ripple"}],key:e.id,staticClass:"bg-darkl1 q-mb-sm",attrs:{clickable:""},on:{click:function(s){return t.showLog(e.id)}}},[s("q-card-section",[s("div",{staticClass:"row items-center"},[s("div",{staticClass:"col"},[s("div",{staticClass:"text-h4 text-white"},[t._v(t._s(e.id))]),s("div",{staticClass:"text-h6 text-light-blue"},[t._v(t._s(e.from.alias))]),s("div",{staticClass:"text-amber-13"},[t._v(t._s(e.notes))])]),s("div",{staticClass:"text-center self-end"},[s("div",[s("q-avatar",{attrs:{size:"70px"}},[s("img",{attrs:{src:t.buildlog(e,"avatar")}})])],1),s("div",[t._v(t._s(t.buildlog(e,"resp")))]),s("div",[s("span",{staticClass:"text-white text-bold"},[t._v(t._s(t.buildlog(e,"time")))])])])])])],1)})),1)],1)],1),s("div",{staticClass:"col q-px-sm"},[s("q-card",{staticClass:"bg-darkl0"},[s("q-toolbar",{staticClass:"q-mb-sm text-green-13 bg-darkl1 text-uppercase text-thin text-h5"},[t._v("\n                        En camino"),s("q-space"),t._v(t._s(t.orderToArrive.length)+"\n                    ")],1)],1),s("q-scroll-area",{staticStyle:{height:"75vh","max-width":"100%"}},[s("transition-group",{attrs:{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"}},t._l(t.orderToArrive,(function(e){return s("q-card",{directives:[{name:"ripple",rawName:"v-ripple"}],key:e.id,staticClass:"bg-darkl1 q-mb-sm",attrs:{clickable:""},on:{click:function(s){return t.showLog(e.id)}}},[s("q-card-section",[s("div",{staticClass:"row items-center"},[s("div",{staticClass:"col"},[s("div",{staticClass:"text-h4 text-white"},[t._v(t._s(e.id))]),s("div",{staticClass:"text-h6 text-light-blue"},[t._v(t._s(e.from.alias))]),s("div",{staticClass:"text-amber-13"},[t._v(t._s(e.notes))])]),s("div",{staticClass:"text-center self-end"},[s("div",[s("q-avatar",{attrs:{size:"70px"}},[s("img",{attrs:{src:t.buildlog(e,"avatar")}})])],1),s("div",[t._v(t._s(t.buildlog(e,"resp")))]),s("div",[s("span",{staticClass:"text-white text-bold"},[t._v(t._s(t.buildlog(e,"time")))])])])])])],1)})),1)],1)],1),s("div",{staticClass:"col q-px-sm"},[s("q-card",{staticClass:"bg-darkl0"},[s("q-toolbar",{staticClass:"q-mb-sm text-green-13 bg-darkl1 text-uppercase text-thin text-h5"},[t._v("\n                        Entregados"),s("q-space"),t._v(t._s(t.orderOk.length)+"\n                    ")],1)],1),s("q-scroll-area",{staticStyle:{height:"75vh","max-width":"100%"}},[s("transition-group",{attrs:{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"}},t._l(t.orderOk,(function(e){return s("q-card",{directives:[{name:"ripple",rawName:"v-ripple"}],key:e.id,staticClass:"bg-darkl1 q-mb-sm",attrs:{clickable:""},on:{click:function(s){return t.showLog(e.id)}}},[s("q-card-section",[s("div",{staticClass:"row items-center"},[s("div",{staticClass:"col"},[s("div",{staticClass:"text-h4 text-white"},[t._v(t._s(e.id))]),s("div",{staticClass:"text-h6 text-light-blue"},[t._v(t._s(e.from.alias))]),s("div",{staticClass:"text-amber-13"},[t._v(t._s(e.notes))])]),s("div",{staticClass:"text-center self-end"},[s("div",[s("q-avatar",{attrs:{size:"70px"}},[s("img",{attrs:{src:t.buildlog(e,"avatar")}})])],1),s("div",[t._v(t._s(t.buildlog(e,"resp")))]),s("div",[s("span",{staticClass:"text-white text-bold"},[t._v(t._s(t.buildlog(e,"time")))])])])])])],1)})),1)],1)],1)]),s("q-dialog",{model:{value:t.wndLog.state,callback:function(e){t.$set(t.wndLog,"state",e)},expression:"wndLog.state"}},[t.wndLog.order?s("q-card",{staticClass:"exo bg-darkl0 text-grey-5",staticStyle:{width:"500px"}},[s("q-card-section",[s("div",{staticClass:"row text-white justify-between items-center"},[s("div",{staticClass:"text-h3"},[t._v(t._s(t.wndLog.order.from.alias)+" "+t._s(t.wndLog.order.id))]),s("div",{staticClass:"text-h6"},[s("div",[t._v(t._s(t.ordersize(t.wndLog.order.products)[0])+"m "+t._s(t.ordersize(t.wndLog.order.products)[1])+"p")]),t.wndLog.order&&t.wndLog.order.status.id>1?s("q-btn",{attrs:{icon:"print",flat:"",color:"green-13",loading:t.print.state,disable:t.print.state},on:{click:t.reprint}}):t._e()],1)]),s("q-timeline",{attrs:{dark:"",color:"green-13"}},t._l(t.wndLog.order.log,(function(e){return s("q-timeline-entry",{key:e.id,attrs:{subtitle:e.details.responsable,title:e.name}},[s("div",{staticClass:"row text-center"},[s("div",{staticClass:"col row items-center"},[s("q-icon",{attrs:{name:"fas fa-hourglass-start",color:"blue-grey-7"}}),s("span",{staticClass:"text-white q-px-sm"},[t._v(t._s(t.humantime(e.created_at)))])],1),s("div",{staticClass:"col row items-center"},[s("q-icon",{attrs:{name:"fas fa-hourglass-end",color:"blue-grey-7"}}),s("span",{staticClass:"text-white q-px-sm"},[t._v(t._s(e.updated_at==e.created_at?"--":t.humantime(e.updated_at)))])],1),s("div",{staticClass:"col row items-center"},[s("q-icon",{attrs:{name:"fas fa-stopwatch",color:"blue-grey-7"}}),s("span",{staticClass:"text-white q-px-sm"},[t._v(t._s(t.duration(e)))])],1)]),s("div",{staticClass:"text-right"},[2==t.wndLog.order.status.id&&2==e.id?s("div",{staticClass:"q-pt-md"},[s("q-btn",{attrs:{outline:"",color:"green-13",label:"iniciar surtido",disable:t.moving,loading:t.moving},on:{click:function(e){return t.changeState()}}})],1):t._e(),3==t.wndLog.order.status.id&&3==e.id?s("div",{staticClass:"q-pt-md"},[s("q-btn",{attrs:{outline:"",color:"purple-13",label:"Iniciar envio",disable:t.moving,loading:t.moving},on:{click:function(e){return t.changeState(5)}}})],1):t._e()])])})),1),9==t.wndLog.order.status.id?s("div",{staticClass:"text-h6 text-light-blue-13 text-center text-"},[t._v("\n                        Pedido completado en "+t._s(t.totalduration(t.wndLog.order.log))+"\n                    ")]):t._e()],1)],1):t._e()],1)],1)},i=[],r=s("bd4c"),o=s("bd9f"),d=s("1d6c"),n={components:{ToolbarAccount:d["a"]},data(){return{filtdash:{searcher:"",view:[],crude:null},index:void 0,initpagination:{sortBy:"id",descending:!1,rowsPerPage:0},sounds:{creating:new Audio("sounds/creating.mp3"),created:new Audio("sounds/waiting.mp3"),moved:new Audio("sounds/moved.mp3"),removed:new Audio("sounds/removed.mp3"),done:new Audio("sounds/done.mp3")},wndLog:{state:!1,order:void 0},moving:!1,print:{state:!1}}},async beforeMount(){this.index=await o["a"].dashboard(),await this.$sktRestock.connect(),this.$sktRestock.emit("joinat",{user:this.profile,isdashboard:!0,from:this.workin.workpoint}),this.$sktRestock.on("joineddashreq",(t=>{console.log(t),console.log(`%c${t.notify}`,"color:#3ae374;font-size:1.5em;")})),this.$sktRestock.on("creating",(t=>{this.sktOrderCreating(t)})),this.$sktRestock.on("order_open",(t=>{this.orderHere(t)&&this.sktOrderOpen(t)})),this.$sktRestock.on("order_update",(t=>{this.orderHere(t)&&this.sktOrderUpdate(t)})),this.$sktRestock.on("order_changestate",(t=>{this.orderHere(t)&&this.sktOrderChangeState(t)}))},beforeDestroy(){this.$sktRestock.emit("leave",{room:this.socketroom,user:this.profile})},methods:{sktOrderUpdate(t){console.log(t);let e=this.ordersdb.findIndex((e=>e.id==t.order.id)),s=null;switch(t.cmd){case"add":this.ordersdb[e].products.push(t.product);break;case"edit":s=this.ordersdb[e].products.findIndex((e=>e.id==t.product.id)),this.ordersdb[e].products[s]=Object.assign(this.ordersdb[e].products[s],t.product);break;case"remove":s=this.ordersdb[e].products.findIndex((e=>e.id==t.product)),this.ordersdb[e].products.splice(s,1);break;default:console.log("Comando desconocido!!");break}},sktOrderOpen(t){console.log(`%cPedido ${t.order.id} ha sido abierto`,"color:#3ae374;font-size:1.5em;")},sktOrderCreating(t){console.log(t.order),console.log("Se esta levantando un pedido!!"),t.to.label==this.workin.workpoint.alias?(console.log("%cEl pedido pertenece a este dashboard","font-size:1.5;color:#3ae374;"),this.ordersdb.unshift(t.order),this.sounds.creating.play()):console.log("%cPero no pertenece a este dashboard","font-size:1.5;color:#ff9f1a;")},sktOrderChangeState(t){console.log("Actualizando status a pedido");let e=this.ordersdb.findIndex((e=>e.id==t.order.id));switch(console.log(t.order),console.log(this.ordersdb[e]),this.ordersdb[e]=Object.assign(this.ordersdb[e],t.order),t.state.id){case 2:this.sounds.created.play();break;case 9:this.sounds.done.play();break;case 10:this.sounds.removed.play();break;default:this.sounds.moved.play();break}},orderHere(t){return this.ordersdb.findIndex((e=>e.id==t.order.id))>=0},reprint(){console.log("reimprimiendo");let t={_requisition:this.wndLog.order.id};this.print.state=!0,o["a"].reprint(t).then((t=>{console.log(t),this.print.state=!1;let e=this.ordersdb.findIndex((t=>t.id==this.wndLog.order.id));this.ordersdb[e].printed+=1})).catch((t=>{console.log(t)}))},showLog(t){let e=this.ordersdb.findIndex((e=>e.id==t));this.wndLog.order=this.ordersdb[e],console.log(this.wndLog.order),this.wndLog.state=!0},changeState(t=null){this.moving=!0;let e=t||parseInt(this.wndLog.order.status.id)+1,s={id:this.wndLog.order.id,_status:e},a="",i={id:e,name:void 0};this.sounds.moved;switch(e){case 3:console.log("Moviendo a surtiendo..."),i.name="Surtiendo",a="Surtido iniciado";break;case 5:console.log("Moviendo a En camino..."),i.name="En camino",a="Envio iniciado";break}o["a"].nextstep(s).then((t=>{let e=t.data;console.log(e),this.wndLog.state=!1,this.moving=!1;let s=this.ordersdb.findIndex((t=>t.id==e.order.id));this.ordersdb[s].log=e.order.log,this.ordersdb[s].status=e.order.status,this.$q.notify({message:a,color:"positive",icon:"done",position:"bottom-right"}),this.sounds.moved.play(),this.$sktRestock.emit("order_changestate",{state:i,profile:this.profile,order:this.ordersdb[s],from:this.workin,room:this.socketroom})})).catch((t=>{console.log(t)}))}},computed:{workin(){return this.$store.getters["Account/workin"]},profile:{get(){return this.$store.getters["Account/profile"]}},appconnected(){return!!this.$sktRestock&&this.$sktRestock.connected},ordersdb(){return this.index?this.index:[]},orderTaking(){return this.ordersdb.filter((t=>1==t.status.id))},orderForSupply(){return this.ordersdb.filter((t=>2==t.status.id))},orderSuppling(){return this.ordersdb.filter((t=>3==t.status.id))},orderCheckout(){return this.ordersdb.filter((t=>4==t.status.id))},orderToArrive(){return this.ordersdb.filter((t=>5==t.status.id))},orderArrived(){return this.ordersdb.filter((t=>6==t.status.id||7==t.status.id))},orderOk(){return this.ordersdb.filter((t=>9==t.status.id))},orderArchive(){return this.ordersdb.filter((t=>10==t.status.id||11==t.status.id))},noprinteds(){return this.orderForSupply.filter((t=>t.printed))},ismobile(){return this.$q.platform.is.mobile},buildlog(){return(t,e)=>{let s,a=t.log.findIndex((e=>t.status.id==e.id));switch(e){case"time":let e=Date.parse(t.log[a].created_at);s=r["b"].formatDate(e,"hh:mm a");break;case"avatar":return"https://www.flaticon.es/svg/static/icons/svg/1674/1674229.svg";case"resp":return t.log[a].details.responsable}return s}},humantime(){return t=>{let e=Date.now(),s=Date.parse(t),a=r["b"].getDateDiff(e,s,"days");switch(a){case 0:return"Hoy, "+r["b"].formatDate(s,"hh:mm a");case 1:return"Ayer, "+r["b"].formatDate(s,"hh:mm a");default:return`Hace ${a} dias, `+r["b"].formatDate(s,"hh:mm a")}}},duration(){return t=>{let e=Date.parse(t.created_at),s=Date.parse(t.updated_at),a=r["b"].getDateDiff(s,e,"minutes");if(a<=59)return a+"m";{let t=parseFloat(a/60).toFixed(2).split(".");return`${t[0]}h ${t[1]}m`}}},ordersize(){return t=>{let e=t.length;if(e){let s=t.reduce(((t,e)=>parseInt(e.ordered.amount)+t),0);return[e,s]}return[0,0]}},totalduration(){return t=>{let e=Date.parse(t.filter((t=>1==t.id))[0].created_at),s=Date.parse(t.filter((t=>9==t.id))[0].created_at),a=r["b"].getDateDiff(s,e,"minutes");if(a<=59)return a+"m";{let t=parseFloat(a/60).toFixed(2).split(".");return`${t[0]}h ${t[1]}m`}}},socketroom(){return`${this.workin.workpoint.alias}`}}},l=n,c=(s("54fa"),s("2877")),u=s("9989"),h=s("e359"),p=s("f09f"),v=s("27f9"),m=s("ddd8"),g=s("eaac"),b=s("a370"),x=s("cb32"),_=s("65c6"),f=s("2c91"),w=s("4983"),k=s("54e1"),C=s("0016"),q=s("9c40"),y=s("24e8"),L=s("05eb"),S=s("74af"),$=s("714f"),z=s("eebe"),O=s.n(z),D=Object(c["a"])(l,a,i,!1,null,"0ffc077e",null);e["default"]=D.exports;O()(D,"components",{QPage:u["a"],QHeader:h["a"],QCard:p["a"],QInput:v["a"],QSelect:m["a"],QTable:g["a"],QCardSection:b["a"],QAvatar:x["a"],QToolbar:_["a"],QSpace:f["a"],QScrollArea:w["a"],QBanner:k["a"],QIcon:C["a"],QBtn:q["a"],QDialog:y["a"],QTimeline:L["a"],QTimelineEntry:S["a"]}),O()(D,"directives",{Ripple:$["a"]})}}]);