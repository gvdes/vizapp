(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[27],{c738:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{attrs:{padding:""}},[a("q-header",{staticClass:"bg-darkl1",attrs:{elevated:""}},[a("div",{staticClass:"q-py-sm text-uppercase row items-center"},[a("q-btn",{attrs:{flat:"",icon:"fas fa-chevron-left",color:"white"},on:{click:function(e){return t.$router.push("/almacen/contador")}}}),a("span",{staticClass:"text-light-blue-13"},[t._v(" Configuracion de Inventario "+t._s(this.$route.params.id))])],1)]),t.data?[a("q-card",{staticClass:"q-mt-xs bg-darkl1 exo"},[a("q-card-section",[t._v("\n                Creacion: "+t._s(t.data.inventory.created_at)),a("br"),t._v("\n                Administrador: "+t._s(t.data.inventory.created_by.names)+" "+t._s(t.data.inventory.created_by.surname_pat)+" [ "+t._s(t.data.inventory.created_by.nick)+" ]"),a("br")])],1),a("div",{class:t.wrapperClass+" q-pt-md q-mb-xl q-gutter-md"},[a("q-card",{staticClass:"col bg-darkl1 exo"},[a("q-expansion-item",{attrs:{"expand-separator":"",icon:"fas fa-users",label:"Responsables",caption:t.group.length.toString(),"header-class":"text-grey-5"},model:{value:t.expands.respos,callback:function(e){t.$set(t.expands,"respos",e)},expression:"expands.respos"}},[a("q-card-section",[a("q-list",t._l(t.natAccounts,(function(e){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:e.id,attrs:{tag:"label"}},[a("q-item-section",{attrs:{avatar:""}},[a("q-checkbox",{attrs:{disable:1!=t.data.inventory.status.id,dark:"",val:e.id,color:"green-13"},on:{input:function(a){return t.toggleReponsable(e.id)}},model:{value:t.group,callback:function(e){t.group=e},expression:"group"}})],1),a("q-item-section",[a("q-item-label",[a("span",{staticClass:"text-grey-6"},[t._v(t._s(e.names+" "+e.surname_pat))]),a("br"),t._v("\n                                        [ "+t._s(e.nick.toLowerCase())+" ]\n                                    ")])],1)],1)})),1)],1)],1)],1),a("q-card",{staticClass:"col bg-darkl1 exo"},[a("q-expansion-item",{attrs:{"expand-separator":"",icon:"fas fa-boxes",label:"Productos",caption:t.listProducts.length.toString(),"header-class":"text-grey-5"},model:{value:t.expands.products,callback:function(e){t.$set(t.expands,"products",e)},expression:"expands.products"}},[a("q-card-section",[a("div",{staticClass:"row items-start"},[1==t.data.inventory.status.id?a("div",{staticClass:"col"},[a("q-select",{attrs:{dark:"",dense:"",flat:"",color:"green-13",label:"Agregar por...","stack-label":"",options:t.optsAddProds},on:{input:t.modeAddChanged},model:{value:t.modeAdd,callback:function(e){t.modeAdd=e},expression:"modeAdd"}})],1):t._e()])]),t.modeAdd?a("q-card-section",[1==t.modeAdd.value?a("CategoriesBrowser",{on:{selectedCat:t.selectedCat}}):t._e(),2==t.modeAdd.value?a("WarehousesBrowser",{on:{selectedLoc:t.selectedLoc}}):t._e(),3==t.modeAdd.value?a("div",[a("ProductAutocomplete")],1):t._e()],1):t._e(),a("q-card-section",{staticStyle:{"max-width":"100%"}},[a("q-table",{attrs:{dark:"",flat:"","card-class":"bg-none",data:t.listProducts,columns:t.tableProducts.columns,"visible-columns":t.tableProducts.visibleColumns},scopedSlots:t._u([{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{key:"id",attrs:{props:e}},[t._v(t._s(e.row.id))]),a("q-td",{key:"code",attrs:{props:e}},[t._v(t._s(e.row.code))]),a("q-td",{key:"description",staticClass:"text--2",attrs:{props:e}},[t._v(t._s(e.row.description))]),a("q-td",{key:"locations",attrs:{props:e}},[t._v("\n                                        [ "+t._s(e.row.locations.length)+" ]\n                                        "),t._l(e.row.locations,(function(e,o){return a("span",{key:o},[t._v(t._s(e.path))])}))],2)],1)]}}],null,!1,3869234322)})],1)],1)],1)],1)]:t._e(),a("q-page-sticky",{attrs:{position:"bottom-left",offset:[10,10]}},[t.trydiscard?[a("q-btn",{attrs:{rounded:"","no-caps":"",color:"primary",icon:"close",label:"No Eliminar"},on:{click:function(e){t.trydiscard=!1}}}),a("q-btn",{attrs:{rounded:"","no-caps":"",color:"negative",label:"Â¡Confirmar Eliminacion de Inventario!"},on:{click:function(e){return t.nextStep(4)}}})]:a("q-btn",{attrs:{rounded:"","no-caps":"",color:"orange-14",icon:"delete",label:"Eliminar"},on:{click:function(e){t.trydiscard=!0}}})],2),t.canStart&&!t.trydiscard?a("q-page-sticky",{attrs:{position:"bottom-right",offset:[10,10]}},[a("q-btn",{attrs:{rounded:"","no-caps":"",color:"primary",icon:"fas fa-play-circle",label:"Iniciar"},on:{click:t.start}})],1):t._e()],2)},s=[],n=(a("e01a"),a("e6cf"),a("e0df")),r=a("31b8"),i={join(t){return r["b"].get("/workpoint/join")},get(t){return r["b"].post("account/users",t)}},c=a("b293"),l=a("7908"),d=a("a647"),u={components:{ProductAutocomplete:c["a"],CategoriesBrowser:l["a"],WarehousesBrowser:d["a"]},data(){return{data:null,natAccounts:null,trydiscard:!1,group:[],optsAddProds:[{label:"Categoria",value:1},{label:"Ubicacion",value:2}],modeAdd:null,listProducts:[],tableProducts:{columns:[{name:"id",align:"left",label:"ID",field:t=>t.id,sortable:!0},{name:"code",align:"left",label:"Codigo",field:t=>t.code,sortable:!0},{name:"description",align:"left",label:"Descripcion",field:t=>t.description},{name:"locations",align:"center",label:"Ubicaciones",field:t=>t.locations.length,sortable:!0}],visibleColumns:["code","locations"]},expands:{respos:!0,products:!0},settings:new Object}},async beforeMount(){this.$store.commit("Layout/hideToolbarModule"),this.data=await n["a"].find(this.$route.params.id),console.log(this.data),this.listProducts=this.data.inventory.products,this.getAccounts()},methods:{getAccounts(){i.get({_rol:[7]}).then((t=>{console.log(t.data),this.natAccounts=t.data.map((t=>(this.data.inventory.responsables.forEach((e=>{e.id==t.id&&this.group.push(t.id)})),t)))})).catch((t=>{console.log(t)}))},toggleReponsable(t){let e={_responsable:t,_inventory:this.$route.params.id};n["a"].toggleReponsable(e).then((t=>{console.log(t.data),console.log(this.group)})).catch((t=>{console.log(t)}))},selectedCat(t){console.log("Categoria Seleccionada"),this.settings.category=t.category,this.listProducts=t.products.length?t.products:[],console.log(this.settings)},selectedLoc(t){console.log("Ubicacion seleccionada"),this.settings.warehouse=t.warehouse,this.settings.section=t.section?t.section.model.value:null,this.listProducts=t.products.length?t.products:[]},async modeAddChanged(){this.settings=new Object,this.listProducts=[],this.settings.addmode=this.modeAdd.value},start(){console.log("Iniciando ");let t=this.listProducts.map((t=>t.id)),e={_products:t,_inventory:this.data.inventory.id,settings:this.settings};this.$q.loading.show({message:"Aplicando configuracion, porfavor espera..."}),n["a"].addProducts(e).then((t=>{this.nextStep()})).catch((t=>{console.log(t)}))},nextStep(t,e){let a=this.data.inventory.status,o="";console.log("Estatus Actual: "+a.id);let s=t||a.id+1;switch(s){case 2:o="Iniciando Inventario, espera...";break;case 3:o="Cerrando Inventario, esperaa..";break;case 4:o="Eliminando Inventario, espera...";break}this.$q.loading.show({message:o});let r={_inventory:this.data.inventory.id,_status:s};console.log("Cambiando status"),console.log(r),n["a"].nextStep(r).then((t=>{let e=t.data;console.log(e),this.data.inventory.status=e.order.status,this.notifyChangeState(e),this.$q.loading.hide()})).catch((t=>{console.log(t)}))},notifyChangeState(t){let e=t.order.status.id;switch(e){case 2:this.$q.notify({icon:"done",color:"positive",message:"El inventario ya puede realizarse!!",timeout:1200}),this.$q.loading.show(),setTimeout((()=>{this.$router.push("/almacen/contador/"+t.order.id),this.$q.loading.hide()}),1500);break;case 3:msgnewState="Cerrando Inventario, esperaa..";break;case 4:this.$q.notify({icon:"done",color:"positive",message:"El inventario ha sido eliminado!"}),this.$router.push("/almacen/contador");break}}},beforeDestroy(){this.$store.commit("Layout/showToolbarModule"),localStorage.removeItem("statelocator")},computed:{fullpath(){let t="";return this.warehouses.sectModels.forEach(((e,a,o)=>{e.value&&(t+=0==a?`${e.label}`:`-${e.label}`)})),t},auths(){return this.$store.getters["Account/moduleauths"]},profile(){return this.$store.getters["Account/profile"]},canStart(){return this.listProducts.length&&this.group.length},wrapperClass(){return this.$q.platform.is.mobile?"column":"row items-start"}}},p=u,g=a("2877"),h=a("9989"),m=a("e359"),b=a("9c40"),v=a("f09f"),f=a("a370"),y=a("3b73"),_=a("1c1c"),q=a("66e5"),k=a("4074"),w=a("8f8e"),x=a("0016"),C=a("0170"),A=a("ddd8"),$=a("eaac"),P=a("bd08"),S=a("db86"),Q=a("de5e"),I=a("714f"),E=a("eebe"),L=a.n(E),T=Object(g["a"])(p,o,s,!1,null,null,null);e["default"]=T.exports;L()(T,"components",{QPage:h["a"],QHeader:m["a"],QBtn:b["a"],QCard:v["a"],QCardSection:f["a"],QExpansionItem:y["a"],QList:_["a"],QItem:q["a"],QItemSection:k["a"],QCheckbox:w["a"],QIcon:x["a"],QItemLabel:C["a"],QSelect:A["a"],QTable:$["a"],QTr:P["a"],QTd:S["a"],QPageSticky:Q["a"]}),L()(T,"directives",{Ripple:I["a"]})}}]);