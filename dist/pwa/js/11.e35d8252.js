(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[11],{"0fdc":function(o,e,t){"use strict";t("f48c")},ab74:function(o,e,t){"use strict";t.r(e);var s=function(){var o=this,e=o._self._c;return e("q-layout",{attrs:{view:"lHh Lpr lFf"}},[e("q-page-container",{staticClass:"exo bg-darkl0 text-grey-5"},[o.layout.header.state?e("q-header",{staticClass:"bg-none"},[e("q-card",{staticClass:"bg-darkl1"},[e("HeaderApp",{attrs:{title:o.layout.header.title}}),e("div",{staticClass:"bg-darkl1 q-pa-sm col row justify-between"},[e("div",{staticClass:"col-md-12 col-xs-12 items-end justify-end col"},[e("RangeDates",{on:{inputRanges:o.loadView}})],1)])],1)],1):o._e(),e("router-view"),o.layout.footer.state?e("q-footer",{staticClass:"bg-darktransl0",attrs:{reveal:""}},[e("ToolbarModule",{attrs:{with_home:!0}})],1):o._e()],1)],1)},i=[],r=(t("caad"),t("b0fc")),a=t("7538"),d=t("1670"),n=t("bd9f"),l={name:"Resurtido",components:{ToolbarModule:r["a"],RangeDates:a["a"],HeaderApp:d["a"]},data(){return{flagPermissions:!0,flag:!0,dialog:!1,date:void 0,index:[],rsocket:this.$sktRestock}},created(){this.rsocket.disconnect(),this.rsocket.connect(),this.rsocket.on("joineddashreq",(o=>{this.sktJoinatRes(o)})),this.rsocket.on("creating",(o=>{this.sktCreateOrd(o)})),this.rsocket.on("order_update",(o=>{this.sktUpdateOrd(o)})),this.rsocket.on("order_changestate",(o=>{this.sktChangeState(o)})),this.rsocket.emit("joinat",{profile:this.profile,workpoint:this.workin.workpoint,room:this.socketroom})},methods:{async loadView(o){this.$q.loading.show({message:"Cargando vista..."});let e={date_from:o.dbranges.from,date_to:o.dbranges.to};this.$store.commit("Requisitions/todayState",this.timeToday(o.ranges.date.from));let t={params:e};if(this.index=await n["a"].index(),this.$store.commit("Requisitions/startState",this.index),console.log("%cLayout Loaded!!","font-size:2em;color:yellow;font-weight:bold;"),console.log(this.index),this.dashAccess){console.log("USUARIO CON ACCESO AL DASHBOARD, OBTENIENDO PEDIDOS");let o=await n["a"].dashboard(t);console.log(o.requisitions),this.$store.commit("Requisitions/setOrdersIn",o.requisitions)}this.$q.loading.hide()},sktJoinatRes(o){console.log(`%cSe unio a Resurtido ${o.user.me.nick}`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},sktCreateOrd(o){let e=o.order,t=o.user.me,s=!1,i=[1,2,16];console.log(`%c${t.nick} esta creando la orden ${e.id}`,"background:#303952;color:#e66767;border-radius:10px;padding:8px;");let r=1==o.order.status.id&&!this.getValidateSounds(o.order),a=i.includes(this.workin.workpoint.id);console.log(a?"Soy un CEDIS":"Soy una TIENDA"),console.log("Orden nueva? : "+r),r&&this.appsounds.ok.play(),o.order.from.id==this.workin.workpoint.id&&(console.log("Es una orden de mi misma tienda"),this.$store.commit("Requisitions/newOrder",e),s=!0),a&&!s&&this.$store.commit("Requisitions/newOrder",e)},sktChangeState(o){console.log(o);let e={state:o.state,log:o.log},t=o.order;t.log=o.log,t.status=o.state,console.log(o.order.from.id),console.log(o.from.workpoint.id),console.log(o.state.id<=9&&o.order.from.id==o.from.workpoint.id),10==o.state.id&&-1!=this.getValidateSounds(o.order)&&this.appsounds.ok.play(),2==o.state.id&&-1!=this.getValidateSounds(o.order)&&this.appsounds.created.play(),o.state.id>=3&&o.state.id<=9&&-1!=this.getValidateSounds(o.order)&&(this.appsounds.added.play(),this.$q.notify({message:`La Orden ${o.order.id} ha cambiado su estatus a ${o.state.name}.`,color:"positive",icon:"done",position:"top-right"})),console.log(`%cLa orden ${o.order.id} cambio su status a ${o.state.name}`,"background:#7158e2;color:#fffa65;border-radius:10px;padding:8px;"),this.$store.commit("Requisitions/updateState",{order:t,newState:e})},sktUpdateOrd(o){if(console.log(o),null==o.product){let e=o.order;console.log(`%cLa orden ${e.id} no añadio el producto seleccionado.`,"background:#7158e2;color:#fffa65;border-radius:10px;padding:8px;")}else{let e=o.order,t=o.product,s="remove"==o.cmd?"removio":"añadio";console.log(`%cLa orden ${e.id} ${s} ${t.description}`,"background:#7158e2;color:#fffa65;border-radius:10px;padding:8px;")}}},beforeDestroy(){console.log("%cDesconectando de resurtido...","background:#F97F51;color:#2C3A47;border-radius:10px;padding:6px;"),this.rsocket.emit("unjoin",{profile:this.profile,workpoint:this.workin.workpoint,room:"main"}),this.rsocket.off()},computed:{timeToday(){return o=>this.$moment().format("YYYY-MM-DD")===o},cedisValidate(){return o=>[o].filter((o=>1==o.workpoint.id||2==o.workpoint.id||16==o.workpoint.id))},getValidateSounds(){return o=>this.$store.getters["Requisitions/getIDX"](o)},appsounds(){return this.$store.getters["Multimediapp/sounds"]},workin(){return this.$store.getters["Account/workin"]},socketroom(){return this.profile.me._rol<=3?"admin":"orders"},profile(){return this.$store.getters["Account/profile"]},layout(){return this.$store.state.Requisitions.layout},dashAccess(){var o;let e=JSON.parse(localStorage.getItem("workin"));return null!==(o=e.module.submodules.find((o=>19==o.id)))&&void 0!==o&&o},checkPermissions(){let o=JSON.parse(localStorage.getItem("workin")),e=[1,2,16,18,13];return!!e.includes(o.workpoint.id)}}},c=l,u=(t("0fdc"),t("2877")),p=t("4d5a"),g=t("09e3"),h=t("e359"),m=t("f09f"),f=t("7ff0"),k=t("9989"),w=t("068f"),b=t("9c40"),$=t("eebe"),y=t.n($),S=Object(u["a"])(c,s,i,!1,null,null,null);e["default"]=S.exports;y()(S,"components",{QLayout:p["a"],QPageContainer:g["a"],QHeader:h["a"],QCard:m["a"],QFooter:f["a"],QPage:k["a"],QImg:w["a"],QBtn:b["a"]})},f48c:function(o,e,t){}}]);