(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{aa1a:function(t,e,o){},ab74:function(t,e,o){"use strict";o.r(e);var s=function(){var t=this,e=t._self._c;return e("q-layout",{attrs:{view:"lHh Lpr lFf"}},[e("q-page-container",{staticClass:"exo bg-darkl0 text-grey-5"},[t.layout.header.state?e("q-header",{staticClass:"bg-none"},[e("q-card",{staticClass:"bg-darkl1"},[e("HeaderApp",{attrs:{title:t.layout.header.title}}),e("div",{staticClass:"bg-darkl1 q-pa-sm col row justify-between"},[e("div",{staticClass:"col-md-12 col-xs-12 items-end justify-end col"},[e("RangeDates",{on:{inputRanges:t.loadView}})],1)])],1)],1):t._e(),e("router-view"),t.layout.footer.state?e("q-footer",{staticClass:"bg-darktransl0",attrs:{reveal:""}},[e("ToolbarModule",{attrs:{with_home:!0}})],1):t._e()],1)],1)},i=[],r=(o("caad"),o("b0fc")),a=o("7538"),d=o("1670"),n=o("bd9f"),l={name:"Resurtido",components:{ToolbarModule:r["a"],RangeDates:a["a"],HeaderApp:d["a"]},data(){return{flagPermissions:!0,flag:!0,dialog:!1,date:void 0,index:[],rsocket:this.$sktRestock}},created(){this.rsocket.disconnect(),this.rsocket.connect(),this.rsocket.on("joineddashreq",(t=>{this.sktJoinatRes(t)})),this.rsocket.on("creating",(t=>{this.sktCreateOrd(t)})),this.rsocket.on("order_update",(t=>{this.sktUpdateOrd(t)})),this.rsocket.on("order_changestate",(t=>{this.sktChangeState(t)})),this.rsocket.emit("joinat",{profile:this.profile,workpoint:this.workin.workpoint,room:this.socketroom})},methods:{async loadView(t){this.$q.loading.show({message:"Cargando vista..."});let e={date_from:t.dbranges.from,date_to:t.dbranges.to};this.$store.commit("Requisitions/todayState",this.timeToday(t.ranges.date.from));let o={params:e};if(this.index=await n["a"].index(),this.$store.commit("Requisitions/startState",this.index),this.dashAccess){console.log("USUARIO CON ACCESO AL DASHBOARD, OBTENIENDO PEDIDOS");let t=await n["a"].dashboard(o);this.$store.commit("Requisitions/setOrdersIn",t.requisitions)}this.$q.loading.hide()},sktJoinatRes(t){console.log(`%cSe unio a Resurtido ${t.user.me.nick}`,"background:#076F3E;color:#f5f6fa;border-radius:10px;padding:10px;font-size:1.1em;")},sktCreateOrd(t){let e=t.order,o=t.user.me;console.log(`%c${o.nick} esta creando la orden ${e.id}`,"background:#303952;color:#e66767;border-radius:10px;padding:8px;");let s=!1;console.log(this.cedisValidate(this.workin).length),1==t.order.status.id&&-1!=this.getValidateSounds(t.order)&&this.appsounds.ok.play(),t.order.from.id==this.workin.workpoint.id&&(this.$store.commit("Requisitions/newOrder",e),s=!0),!this.cedisValidate(this.workin).length||s||this.$store.commit("Requisitions/newOrder",e)},sktChangeState(t){console.log(t);let e={state:t.state,log:t.log},o=t.order;o.log=t.log,o.status=t.state,console.log(t.order.from.id),console.log(t.from.workpoint.id),console.log(t.state.id<=9&&t.order.from.id==t.from.workpoint.id),10==t.state.id&&-1!=this.getValidateSounds(t.order)&&this.appsounds.ok.play(),2==t.state.id&&-1!=this.getValidateSounds(t.order)&&this.appsounds.created.play(),t.state.id>=3&&t.state.id<=9&&-1!=this.getValidateSounds(t.order)&&(this.appsounds.added.play(),this.$q.notify({message:`La Orden ${t.order.id} ha cambiado su estatus a ${t.state.name}.`,color:"positive",icon:"done",position:"top-right"})),console.log(`%cLa orden ${t.order.id} cambio su status a ${t.state.name}`,"background:#7158e2;color:#fffa65;border-radius:10px;padding:8px;"),this.$store.commit("Requisitions/updateState",{order:o,newState:e})},sktUpdateOrd(t){if(console.log(t),null==t.product){let e=t.order;console.log(`%cLa orden ${e.id} no añadio el producto seleccionado.`,"background:#7158e2;color:#fffa65;border-radius:10px;padding:8px;")}else{let e=t.order,o=t.product,s="remove"==t.cmd?"removio":"añadio";console.log(`%cLa orden ${e.id} ${s} ${o.description}`,"background:#7158e2;color:#fffa65;border-radius:10px;padding:8px;")}}},beforeDestroy(){console.log("%cDesconectando de resurtido...","background:#F97F51;color:#2C3A47;border-radius:10px;padding:6px;"),this.rsocket.emit("unjoin",{profile:this.profile,workpoint:this.workin.workpoint,room:"main"}),this.rsocket.off()},computed:{timeToday(){return t=>this.$moment().format("YYYY-MM-DD")===t},cedisValidate(){return t=>[t].filter((t=>1==t.workpoint.id||2==t.workpoint.id||16==t.workpoint.id))},getValidateSounds(){return t=>this.$store.getters["Requisitions/getIDX"](t)},appsounds(){return this.$store.getters["Multimediapp/sounds"]},workin(){return this.$store.getters["Account/workin"]},socketroom(){return this.profile.me._rol<=3?"admin":"orders"},profile(){return this.$store.getters["Account/profile"]},layout(){return this.$store.state.Requisitions.layout},dashAccess(){var t;let e=JSON.parse(localStorage.getItem("workin"));return console.log(e),null!==(t=e.module.submodules.find((t=>19==t.id)))&&void 0!==t&&t},checkPermissions(){let t=JSON.parse(localStorage.getItem("workin")),e=[1,2,16,18,13];return!!e.includes(t.workpoint.id)}}},c=l,u=(o("e082"),o("2877")),p=o("4d5a"),g=o("09e3"),h=o("e359"),m=o("f09f"),k=o("7ff0"),f=o("9989"),w=o("068f"),b=o("9c40"),$=o("eebe"),x=o.n($),y=Object(u["a"])(c,s,i,!1,null,null,null);e["default"]=y.exports;x()(y,"components",{QLayout:p["a"],QPageContainer:g["a"],QHeader:h["a"],QCard:m["a"],QFooter:k["a"],QPage:f["a"],QImg:w["a"],QBtn:b["a"]})},e082:function(t,e,o){"use strict";o("aa1a")}}]);