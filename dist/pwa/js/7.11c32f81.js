(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[7],{1:function(e,t){},"19e8":function(e,t,o){"use strict";var s=o("31b8");t["a"]={join(e){return s["b"].post("/workpoint/join",e)},index(){return s["b"].get("/workpoints").then((e=>(console.log(e),e.data))).catch((e=>{console.log(e)}))}}},"1d6c":function(e,t,o){"use strict";var s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("q-toolbar",{staticClass:"row justify-between items-center"},[o("span",[e.iconlauncher?o("q-btn",{attrs:{dense:"",rounded:"",flat:"",icon:"fab fa-atlassian fa-rotate-180"},on:{click:function(t){return e.$router.push("/")}}}):o("q-icon",{attrs:{name:"fab fa-atlassian fa-rotate-180",size:"25px"}})],1),o("span",{staticClass:"col text-center"},[o("span",[e._v(e._s(e.workin.workpoint.alias))]),o("br"),o("span",[e._v(e._s(e.title))])]),o("span",{staticClass:"text-right"},[o("q-btn",{attrs:{rounded:"",dense:"",color:e.sockstate?"green-13":""}},[o("q-img",{staticStyle:{height:"30px",width:"30px"},attrs:{src:e.picnick,"spinner-color":"white"}}),o("q-menu",{attrs:{"transition-show":"flip-right","transition-hide":"flip-left"}},[o("q-list",{staticClass:"text-grey-8 exo",staticStyle:{"min-width":"150px"}},[o("q-item",[o("q-item-section",[e._v("Hola "+e._s(e.session.me.nick))])],1),o("q-separator"),o("q-item",{attrs:{clickable:""},on:{click:e.sessionDestroy}},[o("q-item-section",[e._v("Salir")])],1)],1)],1)],1)],1)])},r=[],a={name:"ToolbarAccount",props:{title:{type:String,required:!0},iconlauncher:{type:Boolean,default:!0},sockstate:{type:Boolean,default:!1}},methods:{sessionDestroy(){this.$store.commit("Account/unsetsession"),this.$router.push("/acceso")}},computed:{session:{get(){return this.$store.state.Account.profile}},workin:{get(){return this.$store.state.Account.workin}},workpoints:{get(){return this.$store.state.Account.workpoints}},picnick(){return this.session.me.pictures?this.session.me.pictures:"https://www.iconfinder.com/data/icons/avatars-15/64/_Ninja-2-512.png"}}},n=a,i=o("2877"),l=o("65c6"),d=o("9c40"),c=o("0016"),u=o("068f"),p=o("4e73"),h=o("1c1c"),g=o("66e5"),b=o("4074"),m=o("eb85"),f=o("eebe"),w=o.n(f),k=Object(i["a"])(n,s,r,!1,null,null,null);t["a"]=k.exports;w()(k,"components",{QToolbar:l["a"],QBtn:d["a"],QIcon:c["a"],QImg:u["a"],QMenu:p["a"],QList:h["a"],QItem:g["a"],QItemSection:b["a"],QSeparator:m["a"]})},bd9f:function(e,t,o){"use strict";var s=o("31b8");t["a"]={index(){return s["b"].get("/requisition").then((e=>e.data)).catch((e=>{console.log(e)}))},create(e){return console.log("Creando pedido..."),s["b"].post("/requisition",e)},find(e){return console.log("traiendo "+e),s["b"].get("/requisition/"+e).then((e=>{let t=e.data;return console.log(t),t})).catch((e=>{console.log(e)}))},add(e){return console.log(e),s["b"].post("/requisition/add",e)},remove(e){return console.log(e),s["b"].post("/requisition/remove",e)},nextstep(e){return s["b"].post("/requisition/next",e)},dashboard(){return s["b"].get("/requisition/dashboard").then((e=>{let t=e.data;return t})).catch((e=>{console.log(e)}))},reprint(e){return s["b"].post("/requisition/reimpresion",e)}}},f673:function(e,t,o){"use strict";o.r(t);var s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("q-page",{attrs:{padding:""}},[o("q-header",{staticClass:"bg-darkl0 text-grey-5 q-pa-sm"},[o("q-card",{staticClass:"bg-darkl1"},[o("toolbar-account",{attrs:{title:"Resurtido",sockstate:e.appconnected}})],1)],1),o("div",[o("q-table",{attrs:{dark:"",data:e.ordersday,"table-header-class":"text-green-13","card-class":"bg-darkl1 text-grey-6","row-key":"id",columns:e.tableOrders.columns,pagination:e.initpagination},scopedSlots:e._u([{key:"body",fn:function(t){return[o("q-tr",{attrs:{props:t},on:{click:function(o){return e.open(t.row.id)}}},[o("q-td",{key:"id",attrs:{props:t}},[e._v("\n\t\t\t\t\t\t\t"+e._s(t.row.id)+"\n\t\t\t\t\t\t")]),o("q-td",{key:"state",attrs:{props:t}},[o("div",[e._v(e._s(e.labelstate(t.row)))]),o("div",[e._v(e._s(e.timestate(t.row)))])]),o("q-td",{key:"size",attrs:{props:t}},[e._v("\n\t\t\t\t\t\t\t"+e._s(e.ordersize(t.row.products))+"\n\t\t\t\t\t\t")])],1)]}}])})],1),o("q-dialog",{attrs:{position:"bottom"},model:{value:e.wndSetOrder.state,callback:function(t){e.$set(e.wndSetOrder,"state",t)},expression:"wndSetOrder.state"}},[o("q-card",{staticClass:"bg-darkl0 text-grey-6 exo"},[o("q-toolbar",{staticClass:"text-white"},[e._v("Nuevo Pedido")]),o("q-card-section",[o("div",{staticClass:"row q-gutter-md items-center"},[o("q-select",{staticClass:"col",attrs:{dark:"",color:"green-13",label:"Tipo",options:e.comboreqstypes,disable:1==e.comboreqstypes.length},model:{value:e.neworder.type,callback:function(t){e.$set(e.neworder,"type",t)},expression:"neworder.type"}}),o("q-select",{staticClass:"col",attrs:{dark:"",color:"green-13",label:"Destino",options:e.combowkps},model:{value:e.neworder.dest,callback:function(t){e.$set(e.neworder,"dest",t)},expression:"neworder.dest"}})],1),3==e.neworder.type.value||4==e.neworder.type.value?o("div",{staticClass:"row items-center q-gutter-md"},[o("q-select",{staticClass:"col",attrs:{dark:"",color:"green-13",label:"Origen",options:e.combowkpsorigin},model:{value:e.neworder.origin,callback:function(t){e.$set(e.neworder,"origin",t)},expression:"neworder.origin"}}),o("q-input",{staticClass:"col",attrs:{dark:"",type:"text",color:"green-13",label:"Folio"},model:{value:e.neworder.folio,callback:function(t){e.$set(e.neworder,"folio",t)},expression:"neworder.folio"}})],1):e._e(),o("q-input",{attrs:{dark:"",color:"green-13",label:"notas"},model:{value:e.neworder.notes,callback:function(t){e.$set(e.neworder,"notes",t)},expression:"neworder.notes"}})],1),o("q-card-actions",{attrs:{align:"right"}},[o("q-btn",{staticClass:"bg-darkl1 shadow-1",attrs:{rounded:"",flat:"",color:"green-13",icon:"done",loading:e.wndSetOrder.creating,disable:e.wndSetOrder.creating},on:{click:e.tryCreate}})],1)],1)],1),o("q-page-sticky",{attrs:{position:"bottom-right",offset:[10,5]}},[o("q-btn",{staticClass:"bg-darkl1 shadow-1",attrs:{rounded:"",flat:"",color:"green-13",icon:"add"},on:{click:function(t){e.wndSetOrder.state=!0}}})],1)],1)},r=[],a=(o("13d5"),o("e6cf"),o("8055")),n=o.n(a),i=o("1d6c"),l=o("bd9f"),d=o("19e8"),c=o("bd4c"),u=o("981c"),p={components:{ToolbarAccount:i["a"]},data(){return{vsocket:void 0,initpagination:{sortBy:"id",descending:!1,page:1,rowsPerPage:20},status:[],index:void 0,tableOrders:{columns:[{name:"id",align:"left",label:"ID"},{name:"state",align:"left",label:"Estado"},{name:"size",align:"center",label:"Contenido"}],data:void 0},wndSetOrder:{state:!1,creating:!1},neworder:{notes:"",type:{label:"Manual",value:1},dest:{label:"CEDISSAP",value:1},origin:{label:"---",value:null},"folio:":void 0},sounds:{moved:new Audio("sounds/moved.mp3")},workpoints:void 0}},async beforeMount(){console.log(this.auths),this.index=await this.loadIndex(),this.tableOrders.data=this.index.requisitions,this.workpoints=await this.loadWorkpoints(),console.log(this.workpoints)},async mounted(){this.vsocket=await n()(this.$vsocket),this.vsocket.emit("joinme_to_dashboard",this.profile),this.vsocket.on("dashboard_ready",(e=>{console.log("DASHBOARD esta disponible..."),console.log(e)})),this.vsocket.on("order_changestate",(e=>{console.log("Se ha cambiado el status a un pedido... "),console.log(e);let t=this.ordersday.findIndex((t=>t.id==e.order.id));t?(console.log("... y aqui esta"),this.ordersday[t].log=e.order.log,this.ordersday[t].status=e.order.status,this.sounds.moved.play()):console.log("... pero no esta aqui")}))},methods:{loadIndex(){return l["a"].index()},loadWorkpoints(){return d["a"].index()},open(e){console.log("editar "+e),this.$router.push("/pedidos/"+e)},tryCreate(){console.log("Creando pedido!!");let e=new Object;e._workpoint_to=this.neworder.dest.value,e._type=this.neworder.type.value,e.notes=this.neworder.notes;let t=!1;switch(this.neworder.type.value){case 2:this.$q.loading.show({spinner:u["a"],spinnerColor:"green-13",message:"Tu pedido se esta generando, por favor espera mientras consultamos existencias"}),t=!0;break;case 3:case 4:e.folio=this.neworder.folio,e.store=this.neworder.origin.value,e.folio&&e.store?(t=!0,this.$q.loading.show({spinner:u["a"],spinnerColor:"green-13",message:`Buscando folio <b class="text-green-13">${e.folio}</b> en <b class="text-green-13">${e.folio}</b>, porfavor espera`,html:!0})):(t=!1,this.$q.notify({icon:"fas fa-exclamation-circle",color:"red",message:"Sucursal y folio son obligatorios"}));break;default:t=!0,this.wndSetOrder.creating=!0;break}t&&l["a"].create(e).then((e=>{let t=e.data;console.log(t),this.$q.loading.hide(),this.wndSetOrder.creating=!1,this.wndSetOrder.state=!1,this.tableOrders.data.unshift(t.order),this.$q.notify({message:`Pedido ${t.order.id} creado!`,color:"positive",position:"center",timeout:1500}),this.vsocket.emit("creatingorder",{profile:this.profile,order:t.order}),this.$router.push("/pedidos/"+t.order.id)})).catch((e=>{console.log(e),this.$q.notify({message:"Rayos!!, esto no ha funcionado!",icon:"bug",color:"negative"})}))}},computed:{profile:{get(){return this.$store.getters["Account/profile"]}},auths:{get(){return this.$store.getters["Account/moduleauths"]}},appconnected(){return!!this.vsocket&&this.vsocket.connected},combowkps(){return this.index?this.index.workpoints.map((e=>({label:e.alias,value:e.id}))):[]},combowkpsorigin(){return this.workpoints?this.workpoints.filter((e=>"VIZ"!=e.alias)).map((e=>({label:e.alias,value:e.id}))):[]},comboreqstypes(){if(this.index){let e=this.index.types.map((e=>({label:e.name,value:e.id})));return e}return[]},ordersday(){return this.tableOrders.data?this.tableOrders.data:[]},labelstate(){return e=>{let t=e.log.findIndex((t=>t.id==e.status.id));return e.log[t].name}},timestate(){return e=>{let t=e.log.findIndex((t=>t.id==e.status.id)),o=e.log[t].created_at;return this.humantime(o)}},humantime(){return e=>{let t=Date.now(),o=Date.parse(e),s=c["b"].getDateDiff(t,o,"days");switch(s){case 0:return"Hoy a las "+c["b"].formatDate(o,"hh:mm a");case 1:return"Ayer a las "+c["b"].formatDate(o,"hh:mm a");default:return`Hace ${s} dias, a las `+c["b"].formatDate(o,"hh:mm a")}}},ordersize(){return e=>{let t=e.length;if(t){let o=e.reduce(((e,t)=>t.ordered.amount+e),0);return`M:${t}, P:${o}`}return"--"}}}},h=p,g=o("2877"),b=o("9989"),m=o("e359"),f=o("f09f"),w=o("eaac"),k=o("bd08"),v=o("db86"),q=o("24e8"),y=o("65c6"),x=o("a370"),$=o("ddd8"),_=o("27f9"),C=o("4b7e"),S=o("9c40"),Q=o("de5e"),O=o("eebe"),D=o.n(O),A=Object(g["a"])(h,s,r,!1,null,null,null);t["default"]=A.exports;D()(A,"components",{QPage:b["a"],QHeader:m["a"],QCard:f["a"],QTable:w["a"],QTr:k["a"],QTd:v["a"],QDialog:q["a"],QToolbar:y["a"],QCardSection:x["a"],QSelect:$["a"],QInput:_["a"],QCardActions:C["a"],QBtn:S["a"],QPageSticky:Q["a"]})}}]);